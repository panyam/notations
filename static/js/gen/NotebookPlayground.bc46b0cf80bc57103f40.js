!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("notations",[],t):"object"==typeof exports?exports.notations=t():(e.notations=e.notations||{},e.notations.NotebookPlayground=t())}(this,()=>(()=>{"use strict";var e,t={4929(e,t,n){n.r(t),n.d(t,{BeatEndLines:()=>a.Fg,BeatStartLines:()=>a.Ey,BeatView:()=>i.u,Gamaka:()=>o.lD,GamakaType:()=>o.HO,GroupBracket:()=>a.cT,GroupView:()=>l.Jk,Jaaru:()=>a.e1,JaaruGamaka:()=>o.Ab,Kampitham:()=>a.RW,Kandippu:()=>a.jd,LabelEmbelishment:()=>a.Cn,LeafAtomView:()=>l.ZC,LeafAtomViewEmbelishment:()=>a.aL,LineView:()=>r.k,MarkerView:()=>i.w,Nokku:()=>a.B$,NotationView:()=>d.u,OctaveIndicator:()=>a.cq,Odukkal:()=>a.mN,Orikkai:()=>a.bM,Prathyagatham:()=>a.Cf,Raavi:()=>a.Kz,Spuritham:()=>a.uf,Vaali:()=>a.Un,createAtomView:()=>l.jx,parseEmbelishment:()=>o.b_});var o=n(5334),l=n(4760),i=n(8877),a=n(1029),r=n(4254),d=n(6278)},9489(e,t,n){n.r(t),n.d(t,{NotebookPlayground:()=>s});var o=n(5691),l=(n(6464),n(4929));const i=n(4078);n(8600),window.N=o;let a=0;function r(){return"cell-"+ ++a}const d=[{name:"varnam",label:"Varnam Structure",selected:!0,preamble:'\\cycle("|4|2|2|")\n\\beatDuration(4)',cells:[{id:r(),name:"Pallavi - Line 1",source:"Sw: S R G M , P M G R , S _ _ _ , _ _ _ _\nSh: nin nu ko ri , va ra da nun , nu _ _ _ , _ _ _ _"},{id:r(),name:"Pallavi - Line 2",source:"Sw: S R G M , P M G R , S R G M , P _ _ _\nSh: nin nu ko ri , va ra da nun , nu ko ri , va _ _ _"},{id:r(),name:"Anupallavi - Line 1",source:"Sw: P D S. R. , S. D P M , G M P D , S. _ _ _\nSh: en na ju chi , te ne e , man dha ra , va _ _ _"},{id:r(),name:"Anupallavi - Line 2",source:"Sw: P D S. R. , S. D P M , G R S _ , _ _ _ _\nSh: nin nu ko ri , va ra da , nun nu _ , _ _ _ _"},{id:r(),name:"Muktayi - First Speed",source:"Sw: S R G M , P D S. R. , S. D P M , G M P D\nSw: S. R. S. D , P M G R , S _ _ _ , _ _ _ _"}]},{name:"sections",label:"Sections Demo",preamble:'\\cycle("|4|2|2|")\n\\beatDuration(4)',cells:[{id:r(),name:"Introduction",source:"Sw: S R G M  P D N S."},{id:r(),name:"Main Theme - Phrase A",source:"Sw: S R G M , P M G R"},{id:r(),name:"Main Theme - Phrase B",source:"Sw: P D S. R. , S. D P M"},{id:r(),name:"Repeat Pattern",source:"Sw: G R S _ , _ _ _ _"},{id:r(),name:"Conclusion",source:"Sw: S _ _ _ , _ _ _ _"}]},{name:"speeds",label:"Multiple Speeds",preamble:'\\cycle("|4|2|2|")',cells:[{id:r(),name:"First Speed",source:"\\beatDuration(4)\nSw: S , R , G , M , P , D , N , S."},{id:r(),name:"Second Speed",source:"\\beatDuration(2)\nSw: SR , GM , PD , NS. , S.N , DP , MG , RS"},{id:r(),name:"Third Speed",source:"\\beatDuration(1)\nSw: SRGM , PDNS. , S.NDP , MGRS"}]}];class s{constructor(){this.container=null,this.consoleOutput=null,this.sampleSelect=null,this.currentSample=null,this.cells=[],this.editingCellId=null,this.draggedCellId=null,this.init()}init(){this.sampleSelect=document.getElementById("sample-select"),this.sampleSelect&&(this.sampleSelect.innerHTML=d.map(e=>`<option value="${e.name}" ${e.selected?"selected":""}>${e.label}</option>`).join(""),this.sampleSelect.addEventListener("change",()=>{const e=d.find(e=>e.name===this.sampleSelect.value);e&&this.loadSample(e)})),this.consoleOutput=document.getElementById("console-output");const e=document.getElementById("clear-console-btn");null==e||e.addEventListener("click",()=>{this.consoleOutput&&(this.consoleOutput.innerHTML="")});const t=document.getElementById("view-all-btn");if(null==t||t.addEventListener("click",()=>this.openViewAll()),this.container=document.getElementById("notebook-container"),this.container){this.log("Notebook initialized","info");const e=d.find(e=>e.selected)||d[0];this.loadSample(e)}}loadSample(e){this.currentSample=e,this.cells=e.cells.map(e=>Object.assign(Object.assign({},e),{id:r()})),this.editingCellId=null,this.render(),this.log(`Loaded sample: ${e.label} (${this.cells.length} cells)`,"info")}buildFullSource(){if(!this.currentSample)return"";const e=this.cells.map(e=>`\\line("${e.name}")\n${e.source}`);return`${this.currentSample.preamble}\n\n${e.join("\n\n")}`}render(){if(!this.container)return;this.container.innerHTML="";const e=[];this.cells.forEach((t,n)=>{const o=this.editingCellId===t.id,l=this.renderCellStructure(t,n,o);this.container.appendChild(l),e.push({cellEl:l,cell:t,isEditing:o})});const t=document.createElement("button");t.className="notebook-add-cell-btn",t.textContent="+ Add Cell",t.addEventListener("click",()=>this.addCell()),this.container.appendChild(t),requestAnimationFrame(()=>{e.forEach(({cellEl:e,cell:t,isEditing:n})=>{n||this.renderCellNotation(e,t)})})}renderCellStructure(e,t,n){const o=document.createElement("div");o.className="notebook-cell "+(n?"notebook-cell-editing":""),o.dataset.cellId=e.id,o.draggable=!n,o.addEventListener("dragstart",t=>this.onDragStart(t,e.id)),o.addEventListener("dragover",e=>this.onDragOver(e)),o.addEventListener("drop",t=>this.onDrop(t,e.id)),o.addEventListener("dragend",()=>this.onDragEnd());const l=document.createElement("div");l.className="notebook-cell-header";const i=document.createElement("div");i.className="notebook-cell-header-left";const a=document.createElement("span");a.className="notebook-drag-handle",a.textContent="⋮⋮",a.title="Drag to reorder",i.appendChild(a);const r=document.createElement("span");r.className="notebook-cell-name",r.textContent=e.name,i.appendChild(r),l.appendChild(i);const d=document.createElement("div");if(d.className="notebook-cell-controls",n){const t=document.createElement("button");t.className="notebook-btn notebook-apply-btn",t.textContent="Apply",t.addEventListener("click",()=>this.applyEdit(e.id)),d.appendChild(t);const n=document.createElement("button");n.className="notebook-btn notebook-cancel-btn",n.textContent="Cancel",n.addEventListener("click",()=>this.cancelEdit()),d.appendChild(n)}else{const t=document.createElement("button");t.className="notebook-btn notebook-edit-btn",t.textContent="Edit",t.addEventListener("click",()=>this.startEdit(e.id)),d.appendChild(t);const n=document.createElement("button");n.className="notebook-btn notebook-delete-btn",n.textContent="Delete",n.addEventListener("click",()=>this.deleteCell(e.id)),d.appendChild(n)}l.appendChild(d),o.appendChild(l);const s=document.createElement("div");if(s.className="notebook-cell-content",n){const t=document.createElement("input");t.type="text",t.className="notebook-name-input",t.value=e.name,t.placeholder="Cell name",t.dataset.field="name",s.appendChild(t);const n=document.createElement("textarea");n.className="notebook-edit-textarea",n.value=e.source,n.rows=Math.max(3,e.source.split("\n").length+1),n.dataset.field="source",s.appendChild(n)}else{const e=document.createElement("div");e.className="notebook-cell-preview",s.appendChild(e)}return o.appendChild(s),o}renderCellNotation(e,t){var n;const a=e.querySelector(".notebook-cell-preview");if(!a)return;const r=`${(null===(n=this.currentSample)||void 0===n?void 0:n.preamble)||""}\n\\line("${t.name}")\n${t.source}`,[d,s,c]=o.load(r,{log:!0});if(c.length>0){const e=document.createElement("div");e.className="notebook-cell-error",e.textContent=`Error: ${c[0].message||c[0]}`,a.appendChild(e)}else{const e=document.createElement("div");e.className="notation-container",a.appendChild(e),function(e){const t=new l.NotationView(e);return t.markdownParser=function(){const e=new i({html:!0});return t=>{const n=e.parse(t.trim(),{});return e.renderer.render(n,{langPrefix:"v4_"})}}(),t}(e).renderNotation(d,s)}}startEdit(e){this.editingCellId=e,this.render(),this.log("Editing cell","info")}applyEdit(e){var t;const n=null===(t=this.container)||void 0===t?void 0:t.querySelector(`[data-cell-id="${e}"]`);if(!n)return;const o=n.querySelector('input[data-field="name"]'),l=n.querySelector('textarea[data-field="source"]');if(!o||!l)return;const i=this.cells.find(t=>t.id===e);i&&(i.name=o.value,i.source=l.value),this.editingCellId=null,this.render(),this.log("Applied changes","info")}cancelEdit(){this.editingCellId=null,this.render(),this.log("Cancelled edit","info")}deleteCell(e){const t=this.cells.findIndex(t=>t.id===e);if(t>=0){const e=this.cells[t];this.cells.splice(t,1),this.render(),this.log(`Deleted cell: ${e.name}`,"info")}}addCell(){const e={id:r(),name:`New Cell ${this.cells.length+1}`,source:"Sw: S R G M"};this.cells.push(e),this.editingCellId=e.id,this.render(),this.log("Added new cell","info")}onDragStart(e,t){this.draggedCellId=t,e.dataTransfer&&(e.dataTransfer.effectAllowed="move"),e.target.classList.add("dragging")}onDragOver(e){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")}onDrop(e,t){if(e.preventDefault(),!this.draggedCellId||this.draggedCellId===t)return;const n=this.cells.findIndex(e=>e.id===this.draggedCellId),o=this.cells.findIndex(e=>e.id===t);if(n>=0&&o>=0){const[e]=this.cells.splice(n,1);this.cells.splice(o,0,e),this.render(),this.log(`Moved cell to position ${o+1}`,"info")}}onDragEnd(){this.draggedCellId=null,document.querySelectorAll(".notebook-cell.dragging").forEach(e=>{e.classList.remove("dragging")})}log(e,t="info"){if(!this.consoleOutput)return;const n=document.createElement("div");n.className=`console-line console-${t}`,n.textContent=`[${(new Date).toLocaleTimeString()}] ${e}`,this.consoleOutput.appendChild(n),this.consoleOutput.scrollTop=this.consoleOutput.scrollHeight}openViewAll(){var e,t;const n=this.buildFullSource(),[l,i,a]=o.load(n,{log:!1});if(a.length>0)return void this.log(`Cannot view all: ${a[0].message||a[0]}`,"error");const r=window.open("","_blank","width=900,height=700");if(!r)return void this.log("Failed to open new window (popup blocked?)","error");const d=document.documentElement.classList.contains("dark");r.document.write(`\n<!DOCTYPE html>\n<html class="${d?"dark":""}">\n<head>\n  <title>${(null===(e=this.currentSample)||void 0===e?void 0:e.label)||"Notation"} - View All</title>\n  <style>\n    :root {\n      --notation-stroke-color: black;\n      --notation-fill-color: transparent;\n      --notation-text-color: #1a1a1a;\n      --notation-border-color: gray;\n    }\n    :root.dark {\n      --notation-stroke-color: #e5e5e5;\n      --notation-fill-color: transparent;\n      --notation-text-color: #f0f0f0;\n      --notation-border-color: #555;\n    }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n      margin: 0;\n      padding: 2rem;\n      background: ${d?"#121212":"#fff"};\n      color: ${d?"#e0e0e0":"#333"};\n    }\n    h1 {\n      margin: 0 0 1.5rem 0;\n      font-size: 1.5rem;\n      font-weight: 500;\n      border-bottom: 1px solid ${d?"#333":"#e0e0e0"};\n      padding-bottom: 1rem;\n    }\n    #notation-container {\n      overflow-x: auto;\n    }\n    .notationsContentRootTable {\n      border-top: solid 1px var(--notation-border-color);\n      width: 100%;\n    }\n    .notationsContentRootTable text,\n    .atomViewTextRoot {\n      fill: var(--notation-text-color);\n    }\n    .lineAnnotationCell {\n      padding: 10px;\n      vertical-align: top;\n    }\n    .lineContentCell {\n      padding: 5px 0;\n    }\n    .lineRootSVG {\n      overflow: visible;\n    }\n    .bar-start-line, .bar-end-line {\n      stroke: var(--notation-stroke-color);\n    }\n  </style>\n</head>\n<body>\n  <h1>${(null===(t=this.currentSample)||void 0===t?void 0:t.label)||"Notation"}</h1>\n  <div id="notation-container"></div>\n</body>\n</html>\n    `),r.document.close();const s=r.document.getElementById("notation-container");s&&new o.Carnatic.NotationView(s).renderNotation(l,i),this.log("Opened full notation in new window","info")}}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("notebook-playground-container")&&(window.notebookPlayground=new s)})}},n={};function o(e){var l=n[e];if(void 0!==l)return l.exports;var i=n[e]={id:e,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.exports}o.m=t,e=[],o.O=(t,n,l,i)=>{if(!n){var a=1/0;for(c=0;c<e.length;c++){for(var[n,l,i]=e[c],r=!0,d=0;d<n.length;d++)(!1&i||a>=i)&&Object.keys(o.O).every(e=>o.O[e](n[d]))?n.splice(d--,1):(r=!1,i<a&&(a=i));if(r){e.splice(c--,1);var s=l();void 0!==s&&(t=s)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,l,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={759:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var l,i,[a,r,d]=n,s=0;if(a.some(t=>0!==e[t])){for(l in r)o.o(r,l)&&(o.m[l]=r[l]);if(d)var c=d(o)}for(t&&t(n);s<a.length;s++)i=a[s],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(c)},n=this.webpackChunknotations=this.webpackChunknotations||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),o.nc=void 0;var l=o.O(void 0,[995,126,747],()=>o(9489));return o.O(l)})());
//# sourceMappingURL=NotebookPlayground.bc46b0cf80bc57103f40.js.map