"use strict";(this.webpackChunknotations=this.webpackChunknotations||[]).push([[747],{2022(t,e,s){s.d(e,{$E:()=>l,HX:()=>a,LX:()=>o,M8:()=>u,Qu:()=>i,TW:()=>r,ks:()=>c,yK:()=>h});var l,n=s(7757);class i extends n.sV.bk{constructor(){super(...arguments),this.uuid=i.idCounter++,this.lastUpdatedAt=0,this.rows=[],this.rowAligns=new Map,this.colAligns=new Map}debugValue(){return{rows:this.rows.map(t=>t.debugValue()),lastUpdatedAt:this.lastUpdatedAt}}get firstRow(){for(const t of this.rows)if(t.numCells>0)return t.rowIndex;return-1}get firstCol(){let t=-1;for(const e of this.rows){const s=e.firstCol;s>=0&&(t<0||s<t)&&(t=s)}return t}cellsInRow(t){const e=[],s=this.rows[t];if(s)for(const t of s.cells)(null==t?void 0:t.value)&&e.push(t);return e}cellsInCol(t){const e=[];for(const s of this.rows){const l=s.cellAt(t);(null==l?void 0:l.value)&&e.push(l)}return e}addRowAlign(t){this.rowAligns.set(t.uuid,t)}addColAlign(t){this.colAligns.set(t.uuid,t)}addRows(t=-1,e=1){t<0&&(t=this.rows.length);let s=this.rows[t]||null;const l=this.rows[t-1]||null;for(let n=e-1;n>=0;n--){const e=new r(this,t+n);this.rows.splice(t,0,e),null!=s&&e.defaultRowAlign.addSuccessor(s.defaultRowAlign),0==n&&t>0&&l.defaultRowAlign.addSuccessor(e.defaultRowAlign),s=e}for(let s=t+e;s<this.rows.length;s++)this.rows[s].rowIndex+=e;return this}getRow(t){return t>=this.rows.length&&this.addRows(-1,1+t-this.rows.length),this.rows[t]}setValue(t,e,s,n){var i,r;const a=this.getRow(t);if(n||(n=(t,e)=>new o(t,e)),null==s){const t=a.clearCellAt(e);return null!=t&&(null===(i=this.eventHub)||void 0===i||i.emit(l.CLEARED,this,{loc:t.location})),t}{const t=a.cellAt(e,n),i=t.value;return null===(r=this.eventHub)||void 0===r||r.emit(l.UPDATED,this,{loc:t.location,cell:t,oldValue:t.value}),t.value=s,i}}eventHubChanged(){console.log("Event Hub Changed for GridModel")}}i.idCounter=0,function(t){t.ADDED="CellAdded",t.CLEARED="CellCleared",t.REMOVED="CellRemoved",t.UPDATED="CellUpdated",t.MOVED="CellMoved"}(l||(l={}));class o{constructor(t,e,s=null){this.gridRow=t,this.colIndex=e,this.value=s,this.uuid=o.idCounter++,this.rowAlign=t.defaultRowAlign}get rowAlign(){return this._rowAlign}set rowAlign(t){t.addCell(this),this._rowAlign=t}get colAlign(){return this._colAlign}set colAlign(t){t.addCell(this),this._colAlign=t}get location(){return this.gridRow.rowIndex+":"+this.colIndex}get grid(){return this.gridRow.grid}get rowIndex(){return this.gridRow.rowIndex}debugValue(){const t={r:this.gridRow.rowIndex,c:this.colIndex,value:this.value,y:this.rowAlign.coordOffset,h:this.rowAlign.maxLength};return this.colAlign&&(t.x=this.colAlign.coordOffset,t.w=this.colAlign.maxLength),t}}o.idCounter=0;class r{constructor(t,e){this.grid=t,this.rowIndex=e,this.cells=[],this.defaultRowAlign=new h,this.grid.addRowAlign(this.defaultRowAlign)}get firstCol(){var t;for(let e=0;e<this.cells.length;e++)if(null===(t=this.cells[e])||void 0===t?void 0:t.value)return e;return-1}get numCols(){return this.cells.length}get numCells(){let t=0;for(const e of this.cells)null!=e&&null!=e.value&&t++;return t}cellAt(t,e){let s=this.cells[t]||null;return!s&&e&&(this.cells[t]=s=e(this,t),s.gridRow=this,s.colIndex=t,s.rowAlign&&this.grid.addRowAlign(s.rowAlign),s.colAlign&&this.grid.addColAlign(s.colAlign)),s}clearCellAt(t){const e=this.cells[t]||null;return e&&(this.cells[t]=null),e}debugValue(){return{r:this.rowIndex,cells:this.cells.filter(t=>t).map(t=>null==t?void 0:t.debugValue())}}}class a{constructor(){this.uuid=a.idCounter++,this.needsLayout=!1,this._coordOffset=0,this._maxLength=0,this.paddingBefore=5,this.paddingAfter=5,this.cells=[],this.prevLines=[],this.nextLines=[]}get coordOffset(){return this._coordOffset}get maxLength(){return this._maxLength+this.paddingBefore+this.paddingAfter}setMaxLength(t){this._maxLength=t}setPadding(t,e){t>=0&&(this.paddingBefore=t),e>=0&&(this.paddingAfter=e)}addCell(t){return this.beforeAddingCell(t)&&this.cells.push(t),this}removeCell(t){if(this.beforeRemovingCell(t))for(let e=0;e<this.cells.length;e++)if(this.cells[e].uuid==t.uuid){this.cells.splice(e,1);break}return this}addSuccessor(t){for(const e of this.nextLines)if(e==t)return;this.nextLines.push(t),t.prevLines.push(this)}}a.idCounter=0;class u extends a{constructor(){super(...arguments),this.paddingBefore=10,this.paddingAfter=10}setOffset(t){this._coordOffset=t;for(const e of this.cells)if(e.value){const s=this.getCellView(e);this._maxLength<=0&&this.evalMaxLength(),s.setBounds(t,null,this.maxLength,null,!0)}}evalMaxLength(t=[]){this._maxLength=0;for(const t of this.cells)if(t.value){const e=this.getCellView(t);this._maxLength=Math.max(e.minSize.width,this._maxLength)}return this._maxLength}beforeAddingCell(t){return t.colAlign&&t.colAlign!=this&&t.colAlign.removeCell(t),t.colAlign!=this}beforeRemovingCell(t){return t.colAlign==this}}class h extends a{setOffset(t){this._coordOffset=t;for(const e of this.cells)if(e.value){const s=this.getCellView(e);this._maxLength<=0&&this.evalMaxLength(),s.setBounds(null,t,null,this.maxLength,!0)}}evalMaxLength(t=[]){this._maxLength=0;for(const t of this.cells)if(t.value){const e=this.getCellView(t);this._maxLength=Math.max(e.minSize.height,this._maxLength)}return this._maxLength}beforeAddingCell(t){return t.rowAlign&&t.rowAlign!=this&&t.rowAlign.removeCell(t),t.rowAlign!=this}beforeRemovingCell(t){return t.rowAlign==this}}class c{constructor(){this.gridModels=[],this.layoutChangeSubscribers=new Set,this.previousColumnWidths=new Map,this.previousRowHeights=new Map,this.eventHandler=t=>{this.applyModelEvents(t.payload)}}onLayoutChange(t){return this.layoutChangeSubscribers.add(t),()=>{this.layoutChangeSubscribers.delete(t)}}notifyLayoutChange(t){for(const e of this.layoutChangeSubscribers)try{e(t)}catch(t){console.error("Error in layout change callback:",t)}}get subscriberCount(){return this.layoutChangeSubscribers.size}addGridModel(t){var e;return null===(e=t.eventHub)||void 0===e||e.on(n.sV.o_.BATCH_EVENTS,this.eventHandler),this.gridModels.push(t),!0}startingRowAligns(){const t=[],e={};for(const s of this.gridModels)for(const l of s.cellsInRow(s.firstRow))l.rowAlign&&!e[l.rowAlign.uuid]&&(e[l.rowAlign.uuid]=!0,t.push(l.rowAlign));return t}startingColAligns(){const t=[],e={};for(const s of this.gridModels)for(const l of s.cellsInCol(s.firstCol))l.colAlign&&!e[l.colAlign.uuid]&&(e[l.colAlign.uuid]=!0,t.push(l.colAlign));return t}removeGridModel(t){var e;null===(e=t.eventHub)||void 0===e||e.removeOn(n.sV.o_.BATCH_EVENTS,this.eventHandler)}get startingRows(){return this.startingRowAligns()}get startingCols(){return this.startingColAligns()}refreshLayout(t=!0){const e={},s={};for(const t of this.startingRowAligns())t.uuid in e||(e[t.uuid]={align:t,cells:[]});for(const t of this.startingColAligns())t.uuid in s||(s[t.uuid]={align:t,cells:[]});const l=this.doBfsLayout(this.startingRows,e,this.previousRowHeights),n=this.doBfsLayout(this.startingCols,s,this.previousColumnWidths);t&&this.layoutChangeSubscribers.size>0&&this.notifyLayoutChange({affectedRowRange:null,affectedColRange:null,columnWidthsChanged:n,rowHeightsChanged:l,affectedGridModels:this.gridModels})}applyModelEvents(t){const[e,s,l]=this.changesForEvents(t),n=Object.keys(e).length>0,i=Object.keys(s).length>0,o=this.doBfsLayout(this.startingRows,e,this.previousRowHeights),r=this.doBfsLayout(this.startingCols,s,this.previousColumnWidths);if(this.layoutChangeSubscribers.size>0&&(n||i)){const t=this.calculateAffectedRowRange(e),n=this.calculateAffectedColRange(s);this.notifyLayoutChange({affectedRowRange:t,affectedColRange:n,columnWidthsChanged:r,rowHeightsChanged:o,affectedGridModels:l})}}calculateAffectedRowRange(t){let e=1/0,s=-1/0;for(const l in t){const{cells:n}=t[l];for(const t of n){const l=t.gridRow.rowIndex;e=Math.min(e,l),s=Math.max(s,l)}}return e===1/0?null:{start:e,end:s}}calculateAffectedColRange(t){let e=1/0,s=-1/0;for(const l in t){const{cells:n}=t[l];for(const t of n){const l=t.colIndex;e=Math.min(e,l),s=Math.max(s,l)}}return e===1/0?null:{start:e,end:s}}checkAndUpdateLength(t,e){const s=e.get(t.uuid),l=t.maxLength;return e.set(t.uuid,l),void 0===s||s!==l}changesForEvents(t){const e={},s={},l={},n=new Set;for(let i=t.length-1;i>=0;i--){const o=t[i],r=o.payload.loc;if(e[r])continue;e[r]=!0;const[a,u]=r.split(":").map(t=>parseInt(t)),h=o.source;n.add(h);const c=h.getRow(a).cellAt(u);c&&(c.rowAlign.uuid in s||(s[c.rowAlign.uuid]={align:c.rowAlign,cells:[]}),s[c.rowAlign.uuid].cells.push(c),c.colAlign.uuid in l||(l[c.colAlign.uuid]={align:c.colAlign,cells:[]}),l[c.colAlign.uuid].cells.push(c))}return[s,l,Array.from(n)]}ensureGetCellView(t){if(!t.getCellView){if(!this.getCellView)return null;t.getCellView=this.getCellView}return t.getCellView}doBfsLayout(t,e,s){if(!this.getCellView)return!1;let l=!1;for(const t in e){const n=e[t];this.ensureGetCellView(n.align),n.align.evalMaxLength(n.cells),s&&this.checkAndUpdateLength(n.align,s)&&(l=!0)}let n=[];const i={};for(const e of t)n.push([null,e]);const o={};for(;n.length>0;){const t=[];for(let s=0;s<n.length;s++){const[l,r]=n[s];i[r.uuid]=!0;let a=r.coordOffset,u=r.uuid in e;l&&o[l.uuid]&&(a=l.coordOffset+l.maxLength,u=!0),u&&(this.ensureGetCellView(r),r.setOffset(a),o[r.uuid]=!0);for(const e of r.nextLines)i[e.uuid]||t.push([r,e])}n=t}return l}}},5410(t,e,s){s.d(e,{Hv:()=>g,PA:()=>u,SM:()=>o,St:()=>w,WH:()=>a,Zx:()=>f,eB:()=>c,eD:()=>A,oc:()=>p,oo:()=>r,sG:()=>h,sO:()=>m,vy:()=>d,xu:()=>v});var l=s(4836),n=s(9496),i=s(7048);class o{constructor(){this.name="",this.notesOnly=!1,this.index=0}}class r extends l.wC{constructor(t,e="md"){super(),this.content=t,this.contentType=e,this.TYPE="RawBlock"}debugValue(){return Object.assign(Object.assign({},super.debugValue()),{content:this.content,contentType:this.contentType})}}function a(t){return"Block"===t.TYPE}function u(t){return"Line"===t.TYPE}function h(t){return"RawBlock"===t.TYPE}class c extends l.wC{constructor(t,e=null,s=null){super(),this.TYPE="Block",this.blockItems=[],this.localCycle=null,this.localAtomsPerBeat=null,this.localBreaks=null,this.localRoles=new Map,this._parentBlock=null,this._currRoleDef=null,this._currentLine=null,this._observers=[],this._unnamedLayoutParams=[],this._namedLayoutParams=new Map,this._layoutParams=null,this.blockType=t,this.name=s,this._parentBlock=e,e&&this.setParent(e)}addObserver(t){return this._observers.push(t),()=>this.removeObserver(t)}removeObserver(t){const e=this._observers.indexOf(t);e>=0&&this._observers.splice(e,1)}children(){return this.blockItems}get parentBlock(){return this._parentBlock}get cycle(){var t,e;return null!==this.localCycle?this.localCycle:null!==(e=null===(t=this.parentBlock)||void 0===t?void 0:t.cycle)&&void 0!==e?e:null}get atomsPerBeat(){var t,e;return null!==this.localAtomsPerBeat?this.localAtomsPerBeat:null!==(e=null===(t=this.parentBlock)||void 0===t?void 0:t.atomsPerBeat)&&void 0!==e?e:1}get breaks(){var t,e;return null!==this.localBreaks?this.localBreaks:null!==(e=null===(t=this.parentBlock)||void 0===t?void 0:t.breaks)&&void 0!==e?e:[]}get unnamedLayoutParams(){return this._unnamedLayoutParams}get namedLayoutParams(){return this._namedLayoutParams}get layoutParams(){return null==this._layoutParams&&(this._layoutParams=this.findUnnamedLayoutParams(),null==this._layoutParams&&(this._layoutParams=this.snapshotLayoutParams(),this._unnamedLayoutParams.push(this._layoutParams))),this._layoutParams}resetLayoutParams(){this._layoutParams=null,this.resetLine()}snapshotLayoutParams(){const t=this.cycle;if(null==t)throw new Error("Cannot create layout params: no cycle defined");return new i.H({cycle:t,beatDuration:this.atomsPerBeat,layout:this.breaks})}findUnnamedLayoutParams(){const t=this.cycle;return null==t?null:this._unnamedLayoutParams.find(e=>e.beatDuration==this.atomsPerBeat&&t.equals(e.cycle)&&e.lineBreaksEqual(this.breaks))||null}ensureNamedLayoutParams(t){let e=this._namedLayoutParams.get(t)||null;return null!=e&&this._layoutParams==e||(null==e?(e=this.snapshotLayoutParams(),this._namedLayoutParams.set(t,e)):(this.localCycle=e.cycle,this.localAtomsPerBeat=e.beatDuration,this.localBreaks=e.lineBreaks),this._layoutParams=e,this.resetLine()),this._layoutParams}getRole(t){var e,s;return this.localRoles.get(t.toLowerCase())||(null!==(s=null===(e=this.parentBlock)||void 0===e?void 0:e.getRole(t))&&void 0!==s?s:null)}get currRoleDef(){if(null!==this._currRoleDef)return this._currRoleDef;if(this.parentBlock)return this.parentBlock.currRoleDef;const t=Array.from(this.localRoles.values());return t.length>0?t[t.length-1]:null}setCurrRole(t){if(""===(t=t.trim().toLowerCase()))throw new Error("Role name cannot be empty");let e=this.getRole(t);null==e&&(e=this.newRoleDef(t,"sw"===t)),this._currRoleDef=e}get currentLine(){return null===this._currentLine?this.newLine():this._currentLine}newLine(){return null!==this._currentLine&&this._currentLine.isEmpty&&this.removeBlockItem(this._currentLine),this._currentLine=new n.N1,this.addBlockItem(this._currentLine),this._currentLine}resetLine(){this._currentLine=null}newRoleDef(t,e=!1){if(""===(t=t.trim().toLowerCase()))throw new Error("Role name cannot be empty");if(this.localRoles.has(t))throw new Error(`Role '${t}' already exists in this block`);const s=new o;return s.name=t,s.notesOnly=e,s.index=this.localRoles.size,this.localRoles.set(t,s),s}addBlockItem(t){var e;const s=this.blockItems.length;if(t.setParent(this),this.blockItems.push(t),this._eventsEnabled)for(const l of this._observers)null===(e=l.onItemAdded)||void 0===e||e.call(l,this,t,s)}removeBlockItem(t){var e;const s=this.blockItems.indexOf(t);if(s>=0&&(this.blockItems.splice(s,1),t.setParent(null),this._eventsEnabled))for(const l of this._observers)null===(e=l.onItemRemoved)||void 0===e||e.call(l,this,t,s);return s}debugValue(){const t=Object.assign(Object.assign({},super.debugValue()),{blockType:this.blockType,blockItems:this.blockItems.map(t=>t.debugValue())});return this.name&&(t.name=this.name),this.localCycle&&(t.localCycle=this.localCycle.uuid),null!==this.localAtomsPerBeat&&(t.localAtomsPerBeat=this.localAtomsPerBeat),null!==this.localBreaks&&(t.localBreaks=this.localBreaks),this.localRoles.size>0&&(t.localRoles=Array.from(this.localRoles.keys())),t}}function d(t){let e=t.parent;for(;null!==e;){if(e instanceof c)return e;e=e.parent}return null}class g extends c{constructor(t,e=null){super("section",e,t)}children(){return[new r(`# ${this.name}`,"md"),...this.blockItems]}}class f extends c{constructor(t,e=null){super("repeat",e),this.repeatCount=t}children(){if(this.repeatCount<=0)return this.blockItems;const t=[];for(let e=0;e<this.repeatCount;e++)t.push(...this.blockItems);return t}}class m extends c{constructor(t,e=null){super("cycle",e),this.localCycle=t}}class w extends c{constructor(t,e=null){super("beatduration",e),this.localAtomsPerBeat=t}}class A extends c{constructor(t,e=null){super("breaks",e),this.localBreaks=t}}class p extends c{constructor(t,e,s=null){super("role",s),this.newRoleDef(t,e)}}class v extends c{constructor(t,e=null){super("group",e,t)}}}}]);
//# sourceMappingURL=747.d5395923d81283f4312f.js.map