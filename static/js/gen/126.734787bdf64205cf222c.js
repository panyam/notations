"use strict";(this.webpackChunknotations=this.webpackChunknotations||[]).push([[126],{801(t,e,s){s.d(e,{FR:()=>u,Hv:()=>r.Hv,PA:()=>r.PA,SM:()=>r.SM,St:()=>r.St,WH:()=>r.WH,Zx:()=>r.Zx,eB:()=>r.eB,eD:()=>r.eD,es:()=>h,oc:()=>r.oc,oo:()=>r.oo,sG:()=>r.sG,sO:()=>r.sO,uB:()=>l,vy:()=>r.vy,xu:()=>r.xu});var n=s(4836),i=s(2049),o=s(9496),r=s(5410);const a=(0,n.S_)(n.wC);class l extends a{constructor(t=[]){super(),this.autoGenerated=!1,this.prevSibling=null,this.nextSibling=null,this.params=t,this.index=0,this.validateParams()}validateParams(){}get name(){return this.constructor.name}debugValue(){return{name:this.name,index:this.index,params:this.params}}applyToNotation(t){this.applyToBlock(t)}}class h{constructor(t,e,s){this.key=t,this.value=e,this.params=s,s=s||{}}}class u extends r.eB{constructor(){super("notation",null),this.TYPE="Notation",this.metadata=new Map,this.onMissingRole=t=>this.newRoleDef(t,"sw"==t),this._currRoleDef=null,this._currentLine=null,this.localCycle=i.hc.DEFAULT,this.localAtomsPerBeat=1,this.localBreaks=[]}get blocks(){return this.blockItems}get currentAPB(){var t;return null!==(t=this.localAtomsPerBeat)&&void 0!==t?t:1}set currentAPB(t){this.localAtomsPerBeat=t}get currentCycle(){var t;return null!==(t=this.localCycle)&&void 0!==t?t:i.hc.DEFAULT}set currentCycle(t){this.localCycle=t}get currentBreaks(){var t;return null!==(t=this.localBreaks)&&void 0!==t?t:[]}set currentBreaks(t){this.localBreaks=t}get roles(){return Array.from(this.localRoles.values())}setCurrRole(t){if(""==(t=t.trim().toLowerCase()).trim())throw new Error("Role name cannot be empty");const e=this.getRole(t)||this.onMissingRole&&this.onMissingRole(t)||null;if(null==e)throw new Error("Role not found: "+t);this._currRoleDef=e}getRoleDef(t){var e;if(""===(t=t.trim().toLowerCase())){const t=Array.from(this.localRoles.values());return t[t.length-1]||null}return null!==(e=this.localRoles.get(t))&&void 0!==e?e:null}newRoleDef(t,e=!1){if(""===(t=t.trim().toLowerCase()))throw new Error("Role name cannot be empty");if(this.localRoles.has(t))throw new Error("Role already exists: "+t);const s=new r.SM;return s.name=t,s.notesOnly=e,s.index=this.localRoles.size,this.localRoles.set(t,s),s}addLine(t){this.addBlockItem(t)}removeLine(t){return this.removeBlockItem(t)}addRawBlock(t){this.addBlockItem(t),this.resetLine()}addMetaData(t,e=!0){if(e&&!this.metadata.has(t.key)){const e=new r.oo(t.key,"metadata");this.addRawBlock(e)}this.metadata.set(t.key,t)}resetLine(){this._currentLine=null}debugValue(){var t;return{blocks:this.blocks.map(t=>t.debugValue()),currentAPB:this.currentAPB,currentBreaks:this.currentBreaks,currentCycle:null===(t=this.currentCycle)||void 0===t?void 0:t.uuid,roles:this.roles}}get currRoleDef(){if(null==this._currRoleDef){const t=Array.from(this.localRoles.values());if(0===t.length)return null;this._currRoleDef=t[t.length-1]}return this._currRoleDef}get currentLine(){return null==this._currentLine?this.newLine():this._currentLine}newLine(){return this._currentLine&&this._currentLine.isEmpty&&this.removeLine(this._currentLine),this._currentLine=new o.N1,this.addLine(this._currentLine),this._currentLine}}},1029(t,e,s){s.d(e,{B$:()=>c,Cf:()=>d,Cn:()=>a,Ey:()=>l,Fg:()=>h,Kz:()=>p,RW:()=>u,Un:()=>b,aL:()=>o,bM:()=>A,cT:()=>v,cq:()=>r,e1:()=>w,jd:()=>f,mN:()=>g,uf:()=>m});var n=s(7757),i=s(8393);class o extends i.Kf{constructor(t){super(),this.atomView=t}}class r extends o{constructor(t,e){super(t),this.noteView=t,this.note=e,this.dotRadius=1,this.dotSpacing=2.5;const s=this.noteView.embRoot(),i=Math.abs(e.octave);this.dotsElem=n.dv.createSVGNode("g",{doc:document,parent:s,attrs:{width:2*this.dotRadius*i+(i-1)*this.dotSpacing,height:2*this.dotRadius,source:"atom"+this.noteView.leafAtom.uuid}});let o=0;for(let t=0;t<i;t++)n.dv.createSVGNode("circle",{doc:document,parent:this.dotsElem,attrs:{cx:o,cy:0,r:this.dotRadius,class:"notation-octave-dot"}}),o+=this.dotRadius+this.dotRadius+this.dotSpacing}refreshBBox(){return n.dv.svgBBox(this.dotsElem)}refreshMinSize(){const t=Math.abs(this.note.octave);return{width:2*this.dotRadius*t+(t-1)*this.dotSpacing,height:2*this.dotRadius}}updateBounds(t,e,s,n){return null==t&&(t=this.x),null==e&&(e=this.y),[t,e,null,null]}refreshLayout(){this.dotsElem.setAttribute("transform","translate("+this.x+","+this.y+")")}}class a extends o{constructor(t,e){super(e),this.label=t,this.atomView=e;const s=this.atomView.embRoot();this.labelElem=n.dv.createSVGNode("text",{doc:document,parent:s,text:t,attrs:{source:"atom"+this.atomView.leafAtom.uuid,class:"notation-embelishment-label","dominant-baseline":"hanging"}})}refreshBBox(){return n.dv.svgBBox(this.labelElem)}refreshMinSize(){return n.dv.svgBBox(this.labelElem)}updateBounds(t,e,s,n){return[t,e,s,n]}refreshLayout(){this.labelElem.setAttribute("x",""+this.x),this.labelElem.setAttribute("y",""+this.y)}}class l extends i.Kf{constructor(t,e){super(),this.source=t,this.rootElement=e,this.barSpacing=10,this.line=n.dv.createSVGNode("line",{doc:document,parent:this.rootElement,attrs:{class:"bar-start-line"}})}refreshBBox(){return new n.Dh.rw(0,0,0,0)}refreshMinSize(){return new n.Dh.rw(0,0,0,0)}refreshLayout(){const t=this.line,e=this.source.x-this.barSpacing;t.setAttribute("x1",""+e),t.setAttribute("x2",""+e);const s=this.source.y+this.source.bbox.y,n=this.source.bbox.height;t.setAttribute("y1",""+s),t.setAttribute("y2",""+(s+n))}updateBounds(t,e,s,n){return[t,e,null,n]}}class h extends i.Kf{constructor(t,e,s=1){super(),this.source=t,this.rootElement=e,this.lineSpacing=2,this.barSpacing=0,this.lines=[];for(let t=0;t<s;t++)this.lines.push(n.dv.createSVGNode("line",{doc:document,parent:this.rootElement,attrs:{class:"bar-end-line"}}))}refreshBBox(){return new n.Dh.rw(0,0,0,0)}refreshMinSize(){return new n.Dh.rw(0,0,0,0)}updatePosition(t,e){return[t,e]}refreshLayout(){const t=this.source.x+this.source.width+this.barSpacing,e=this.source.y+this.source.bbox.y,s=this.source.bbox.height;let n=t;for(const t of this.lines){const e=""+n;t.setAttribute("x1",e),t.setAttribute("x2",e),n+=4}for(const t of this.lines)t.setAttribute("y1",""+e),t.setAttribute("y2",""+(e+s))}updateBounds(t,e,s,n){return[null,null,null,null]}}class u extends a{constructor(t){super("~",t),this.atomView=t}}class c extends a{constructor(t){super("w",t),this.atomView=t}}class d extends a{constructor(t){super("∵",t),this.atomView=t}}class m extends a{constructor(t){super("∴",t),this.atomView=t}}class p extends a{constructor(t){super("^",t),this.atomView=t}}class f extends a{constructor(t){super("✓",t),this.atomView=t}}class b extends a{constructor(t){super("⌒",t),this.atomView=t}}class g extends a{constructor(t){super("x",t),this.atomView=t}}class A extends a{constructor(t){super("γ",t),this.atomView=t}}class w extends o{constructor(t,e){super(e),this.jaaru=t,this.atomView=e;const s=this.atomView.embRoot();this.pathElem=n.dv.createSVGNode("path",{doc:document,parent:s,attrs:{source:"atom"+this.atomView.leafAtom.uuid,class:"notation-jaaru-path",d:this.pathAttribute()}})}pathAttribute(t=0){const e=this.atomView.glyph.minSize;let s=0;const n=e.height/2,i=t+n;let o=this.atomView.y;return this.jaaru.ascending?(o+=e.height,s=o-n):(o-=n,s=o+n),[`M ${t} ${o}`,`Q ${i} ${o} ${i} ${s}`].join(" ")}refreshMinSize(){return n.dv.svgBBox(this.pathElem)}refreshBBox(){return n.dv.svgBBox(this.pathElem)}updateBounds(t,e,s,n){return[t,null,null,null]}refreshLayout(){this.pathElem.setAttribute("d",this.pathAttribute(this.x))}}class v extends i.Kf{constructor(t){super(),this.groupView=t,this.line=null,this.leftCircle=null,this.rightCircle=null,this.bracketGroup=null,this.lineOffset=2,this.circleRadius=1.5,this.lineExtension=2,this.positionMode="below-embellishments",this.bracketGroup=n.dv.createSVGNode("g",{doc:document,parent:this.groupView.groupElement,attrs:{class:"group-bracket",source:"group"+this.groupView.group.uuid}}),this.line=n.dv.createSVGNode("line",{doc:document,parent:this.bracketGroup,attrs:{class:"group-bracket-line"}}),this.leftCircle=n.dv.createSVGNode("circle",{doc:document,parent:this.bracketGroup,attrs:{class:"group-bracket-circle",r:String(this.circleRadius)}}),this.rightCircle=n.dv.createSVGNode("circle",{doc:document,parent:this.bracketGroup,attrs:{class:"group-bracket-circle",r:String(this.circleRadius)}})}refreshBBox(){return this.bracketGroup?n.dv.svgBBox(this.bracketGroup):new n.Dh.rw(0,0,0,0)}refreshMinSize(){return new n.Dh.or(0,this.lineOffset+this.circleRadius)}updateBounds(t,e,s,n){return[t,e,s,n]}refreshLayout(){if(!this.line||!this.leftCircle||!this.rightCircle)return;const t=this.groupView.bbox,e=this.groupView.contentWidth||t.width;let s;s="below-embellishments"===this.positionMode?t.y+this.lineOffset-2:t.y-this.lineOffset;const n=-this.lineExtension,i=e+this.lineExtension;this.line.setAttribute("x1",String(n)),this.line.setAttribute("y1",String(s)),this.line.setAttribute("x2",String(i)),this.line.setAttribute("y2",String(s)),this.leftCircle.setAttribute("cx",String(n)),this.leftCircle.setAttribute("cy",String(s)),this.rightCircle.setAttribute("cx",String(i)),this.rightCircle.setAttribute("cy",String(s))}}},1292(t,e,s){s.d(e,{Bh:()=>l,D8:()=>h,R3:()=>r,_d:()=>a});var n=s(7757),i=s(4836),o=s(9496);class r extends i.Bb{constructor(t,e=null){super(e=e||{}),this.atom=t,this.TYPE="FlatAtom",this.depth=e.depth||0,this.duration=e.duration||t.duration,this.offset=e.offset||n.Vp.Fraction.ZERO,this.isContinuation="isContinuation"in e&&e.isContinuation}get endOffset(){return this.offset.plus(this.duration)}debugValue(){const t=Object.assign(Object.assign({},super.debugValue()),{atom:this.atom.debugValue(),duration:this.duration.toString(),offset:this.offset.toString(),depth:this.depth});return this.isContinuation&&(t.isContinuation=!0),t}}class a{constructor(...t){this.atomQueue=new n.Q8.B,this.currOffset=n.Vp.Fraction.ZERO,this.peeked=null,this.push(...t)}push(...t){for(const e of t)this.atomQueue.add([e,0,e.duration]);return this}next(){const t=this.peek();return this.peeked=null,null!=t&&(this.currOffset=this.currOffset.plus(t.duration).factorized),t}peek(){if(null==this.peeked&&this.hasNext){const[t,e,s]=this.atomQueue.popFront();this.peeked=new r(t,{depth:e,offset:this.currOffset,duration:s})}return this.peeked}get hasNext(){for(;null!=this.atomQueue.first;){const[t,e,s]=this.atomQueue.first.value;if(t.TYPE!=o.aq.GROUP)return!0;{this.atomQueue.popFront();const n=t;for(const t of n.atoms.reversedValues())this.atomQueue.pushFront([t,e+1,s.times(t.duration).divby(n.totalChildDuration).factorized])}}return!1}static getMin(t){let e=-1,s=null;for(let n=0;n<t.length;n++){const i=t[n].peek();null!=i&&(null==s||i.offset.cmp(s.offset)<0)&&(e=n,s=i)}return e>=0&&t[e].next(),[e,s]}}class l{constructor(...t){this.atomQueue=new n.Q8.B,this.currOffset=n.Vp.Fraction.ZERO,this.peeked=null,this.push(...t)}push(...t){for(const e of t)this.atomQueue.add(e);return this}next(){const t=this.peek();return this.peeked=null,null!=t&&t.participatesInTiming&&(this.currOffset=this.currOffset.plus(t.duration,!0)),t}peek(){return null==this.peeked&&this.hasMore&&(this.peeked=this.atomQueue.popFront()),this.peeked}get hasMore(){return!this.atomQueue.isEmpty}get(t){const e=[];let s=t;for(;s.isGTNum(0)&&this.hasMore;){const t=this.next();if(n.vA(null!=t,"Next cannot be null here"),e.push(t),t.participatesInTiming){const e=t.splitAt(s);s=s.minus(t.duration),null!=e&&this.atomQueue.pushFront(e)}}return[e,s.isZero]}}class h{constructor(t){this.spillOver=null,this.atomIterator=t}get hasMore(){return null!=this.spillOver||this.atomIterator.hasNext}get(t){const e=this.atomIterator,s=[];let i=t;for(;i.isGTNum(0);){const t=null==this.spillOver?e.next():this.spillOver;if(this.spillOver=null,null==t)break;s.push(t),t.duration.cmp(i)<=0?i=i.minus(t.duration):(this.spillOver=new r(new o.$x(t.duration.minus(i))),t.duration=i,i=n.Vp.Fraction.ZERO)}return[s,i.isZero]}}},1826(t,e,s){var n,i,o;s.d(e,{IX:()=>n,P$:()=>i,Tz:()=>o,ny:()=>r}),function(t){t.ADD="add",t.INSERT="insert",t.REMOVE="remove",t.UPDATE="update"}(n||(n={})),function(t){t.ADD="add",t.REMOVE="remove"}(i||(i={})),function(t){t.ADD="add",t.REMOVE="remove"}(o||(o={}));const r={ATOMS_CHANGED:"atomsChanged",ROLES_CHANGED:"rolesChanged",ITEMS_CHANGED:"itemsChanged",DURATION_CHANGED:"durationChanged"}},2049(t,e,s){s.d(e,{hc:()=>l,hp:()=>r,yP:()=>a});var n=s(7757),i=s(4836);const o=n.Vp.Fraction.ZERO;n.Vp.Fraction.ONE;class r{constructor(t,e=0,s=0,n=0){this.cycle=t,this.barIndex=e,this.beatIndex=s,this.instance=n}get next(){const t=this.cycle.bars[this.barIndex],e=[[this.barIndex,this.beatIndex,this.instance],t.beatLengths[this.beatIndex]];return this.instance++,(!t.beatCounts[this.beatIndex]||this.instance>=t.beatCounts[this.beatIndex])&&(this.instance=0,this.beatIndex++,this.beatIndex>=t.beatLengths.length&&(this.beatIndex=0,this.barIndex++,this.barIndex>=this.cycle.bars.length&&(this.barIndex=0))),e}get prev(){const t=this.cycle.bars[this.barIndex],e=[[this.barIndex,this.beatIndex,this.instance],t.beatLengths[this.beatIndex]];return this.instance--,this.instance<0&&(this.beatIndex--,this.beatIndex<0&&(this.barIndex--,this.barIndex<0&&(this.barIndex=this.cycle.bars.length-1),this.beatIndex=this.cycle.bars[this.barIndex].beatCount-1),this.instance=(this.cycle.bars[this.barIndex].beatCounts[this.beatIndex]||1)-1),e}}class a extends i.Bb{constructor(t=null){super(t=t||{}),this.TYPE="Bar",this.beatLengths=[],this.beatCounts=[],this.name=t.name||"";for(const e of t.beatLengths||[])"number"==typeof e?this.beatLengths.push(n.Vp.Frac(e)):this.beatLengths.push(e);for(const e of t.beatCounts||[])this.beatCounts.push(e);for(;this.beatCounts.length<this.beatLengths.length;)this.beatCounts.push(1)}debugValue(){return Object.assign(Object.assign({},super.debugValue()),{name,beatLengths:this.beatLengths})}equals(t){if(!super.equals(t))return!1;if(this.beatLengths.length!=t.beatLengths.length)return!1;if(this.beatCounts.length!=t.beatCounts.length)return!1;for(let e=0;e<this.beatLengths.length;e++)if(!this.beatLengths[e].equals(t.beatLengths[e]))return!1;for(let e=0;e<this.beatCounts.length;e++)if(this.beatCounts[e]!=t.beatCounts[e])return!1;return!0}copyTo(t){super.copyTo(t),t.name=this.name,t.beatLengths=[...this.beatLengths],t.beatCounts=[...this.beatCounts]}instanceCount(t){return t>this.beatCounts.length?1:this.beatCounts[t]}get beatCount(){return this.beatLengths.length}get totalBeatCount(){let t=0;for(let e=0;e<this.beatLengths.length;e++)t+=this.beatCounts[e]||1;return t}get duration(){let t=o;for(let e=0;e<this.beatLengths.length;e++)t=t.plus(this.beatLengths[e].timesNum(this.beatCounts[e]||1));return t}}class l extends i.Bb{constructor(t=null){super(t=t||{}),this.TYPE="Cycle",this.name=t.name||"",this.bars=t.bars||[]}debugValue(){return Object.assign(Object.assign({},super.debugValue()),{name,bars:this.bars.map(t=>t.debugValue())})}children(){return this.bars}equals(t){if(!super.equals(t))return!1;if(this.bars.length!=t.bars.length)return!1;for(let e=0;e<this.bars.length;e++)if(!this.bars[e].equals(t.bars[e]))return!1;return!0}getAtIndex(t){let e=0;for(;t<0;)t+=this.totalBeatCount,e--;t>=this.totalBeatCount&&(e=Math.floor(t/this.totalBeatCount)),t%=this.totalBeatCount;let s=o;for(let n=0;n<this.bars.length;n++){const i=this.bars[n];if(t>=i.totalBeatCount)t-=i.totalBeatCount,s=s.plus(i.duration);else for(let o=0;o<i.beatCount;o++){const r=i.beatLengths[o],a=i.beatCounts[o]||1;if(!(t>=a)){const i=t;return[e,[n,o,i],s.plus(r.timesNum(i))]}t-=a,s=s.plus(r.timesNum(a))}}throw new Error("Should not be here!")}getPosition(t){const e=this.duration;let s=0;if(t.isLT(o))for(;t.isLT(o);)s--,t=t.plus(e);else if(t.isGTE(e)){const i=t.mod(e);t=t.minus(i).divby(e),n.vA(t.isWhole),s=t.floor,t=i}let i=0;for(let e=0;e<this.bars.length;e++){const n=this.bars[e],o=n.duration;if(t.isGTE(o))t=t.minus(o);else for(let o=0;o<n.beatCount;o++){const r=n.beatLengths[o],a=n.beatCounts[o]||1;for(let n=0;n<a;n++,i++){if(!t.isGTE(r))return[s,[e,o,n],t,i];t=t.minus(r)}}i+=n.totalBeatCount}throw new Error("Should not be here!")}*iterateBeats(t=0,e=0,s=0){let n=t,i=e,o=s;for(;;){const t=this.bars[n];yield[[n,i,o],t.beatLengths[i]],o++,(!t.beatCounts[i]||o>=t.beatCounts[i])&&(o=0,i++,i>=t.beatLengths.length&&(i=0,n++,n>=this.bars.length&&(n=0)))}}copyTo(t){super.copyTo(t),t.name=this.name,t.bars=this.bars.map(t=>t.clone())}get beatCount(){let t=0;for(const e of this.bars)t+=e.beatCount;return t}get totalBeatCount(){let t=0;for(const e of this.bars)t+=e.totalBeatCount;return t}get duration(){return this.bars.reduce((t,e)=>t.plus(e.duration),o)}}l.DEFAULT=new l({name:"Adi Thalam",bars:[new a({name:"Laghu",beatLengths:[1,1,1,1]}),new a({name:"Dhrutam",beatLengths:[1,1]}),new a({name:"Dhrutam",beatLengths:[1,1]})]})},4254(t,e,s){s.d(e,{k:()=>i});var n=s(7757);class i{constructor(t,e,s){this.rootElement=t,this.line=e,this.config=s,this.roleSpacing=20,this.rowSpacing=10,this.gElem=n.dv.createSVGNode("g",{parent:this.rootElement,attrs:{class:"lineRoot",id:"lineRoot"+this.line.uuid}})}wrapToSize(){const t=this.gElem.getBBox();this.rootElement.setAttribute("width",""+(4+t.width)),this.rootElement.setAttribute("height",""+(15+t.height)),this.gElem.setAttribute("transform",`translate(${4-t.x}, ${4-t.y})`)}get prefSize(){const t=this.rootElement.getBBox();return new n.Dh.or(4+t.width,4+t.height)}}},4760(t,e,s){s.d(e,{Jk:()=>l,ZC:()=>h,jx:()=>f});var n=s(7757),i=s(9496),o=s(8393),r=s(1029),a=s(5334);class l extends o.Jk{createAtomView(t){return f(this.groupElement,t,this.defaultToNotes,.7,this.depth+1)}createEmbelishments(){const t=super.createEmbelishments();return this.depth>=1&&t.push(new r.cT(this)),t}refreshMinSize(){const t=super.refreshMinSize();return this.depth>=1?new n.Dh.or(t.width,t.height+l.BRACKET_HEIGHT*this.scaleFactor):t}}l.BRACKET_HEIGHT=8;class h extends o.ZC{constructor(){super(...arguments),this.leftSlot=[],this.topSlot=[],this.rightSlot=[],this.bottomSlot=[]}refreshBBox(){return n.dv.svgBBox(this.rootGroup.element)}refreshMinSize(){const t=Object.assign({},this.rootText.minSize),e=this.leftSlot.reduce((t,e)=>t+e.minSize.width,0)+this.rightSlot.reduce((t,e)=>t+e.minSize.width,0)+this.leftSlot.length+this.rightSlot.length,s=this.topSlot.reduce((t,e)=>t+e.minSize.height,0)+this.bottomSlot.reduce((t,e)=>t+e.minSize.height,0);return t.width+=e,t.height+=s,t}get glyphOffset(){return this.leftSlot.reduce((t,e)=>t+e.minSize.width,0)+this.leftSlot.length}updateBounds(t,e,s,n){return[t,e,NaN,NaN]}layoutElements(){this.rootText.minSize;let t=0,e=this.hasY?this.y:0;for(const e of this.leftSlot)e.x=t,e.refreshLayout(),t+=e.minSize.width+1;const s=t;this.rootText.x=t,this.rootText.refreshLayout(),t+=this.rootText.minSize.width;for(const e of this.rightSlot)e.x=t,e.refreshLayout(),t+=e.minSize.width+1;const n=this.glyph.minSize,i=s+this.glyph.x,o=this.glyph.y;e=o-this.glyph.minSize.height+5;for(const t of this.topSlot){const s=t.minSize;t.setBounds(i+(n.width-s.width)/2,e-s.height,null,null,!0),e=t.y}e=o+7;for(const t of this.bottomSlot){const s=t.minSize;t.setBounds(i+(n.width-s.width)/2,e,null,null,!0),e=t.y+s.height}this.invalidateBounds()}refreshLayout(){this.layoutElements(),this.rootGroup.element.setAttribute("transform","translate("+this.x+","+this.y+")")}addEmbelishment(t,e){t.push(e)}orderEmbelishments(){const t=this.leafAtom;if(t.TYPE!=i.aq.SYLLABLE&&t.TYPE!=i.aq.NOTE)return;const e=t;if(0!=e.embelishments.length)for(const t of e.embelishments)switch(t.type){case a.HO.Kampitham:this.addEmbelishment(this.topSlot,new r.RW(this));break;case a.HO.Nokku:this.addEmbelishment(this.topSlot,new r.B$(this));break;case a.HO.Spuritham:this.addEmbelishment(this.topSlot,new r.uf(this));break;case a.HO.Prathyagatham:this.addEmbelishment(this.topSlot,new r.Cf(this));break;case a.HO.Orikkai:this.addEmbelishment(this.topSlot,new r.bM(this));break;case a.HO.Odukkal:this.addEmbelishment(this.topSlot,new r.mN(this));break;case a.HO.Aahaatam_Raavi:this.addEmbelishment(this.topSlot,new r.Kz(this));break;case a.HO.Aahaatam_Kandippu:this.addEmbelishment(this.topSlot,new r.jd(this));break;case a.HO.Vaali:this.addEmbelishment(this.topSlot,new r.Un(this));break;case a.HO.Jaaru_Eetra:case a.HO.Jaaru_Irakka:this.addEmbelishment(this.leftSlot,new r.e1(t,this))}}embRoot(){return this.rootGroup.element}needsRootElement(){return!0}createElements(t){this.createGlyphRoot(t),this.createGlyphElement(),this.orderEmbelishments(),this.createPostSpacingElement(),this.invalidateBounds()}createGlyphRoot(t){this.rootGroup=new o.ai(n.dv.createSVGNode("g",{doc:document,parent:t,attrs:{atomid:this.leafAtom.uuid,class:"atomViewRootGroup",id:"atomViewRootGroup"+this.leafAtom.uuid}})),this.rootText=new o.ai(n.dv.createSVGNode("text",{doc:document,parent:this.rootGroup.element,attrs:{atomid:this.leafAtom.uuid,class:"atomViewTextRoot",id:"atomViewTextRoot"+this.leafAtom.uuid}}))}createGlyphElement(){const t=this.leafAtom;this.glyph=new o.ai(n.dv.createSVGNode("tspan",{doc:document,parent:this.rootText.element,attrs:{atomid:t.uuid,id:"atomGlyph"+t.uuid},text:this.glyphLabel}))}createPostSpacingElement(){this.leafAtom.beforeRest&&(this.postSpacingSpan=n.dv.createSVGNode("tspan",{doc:document,parent:this.rootText.element,attrs:{atomid:this.leafAtom.uuid,id:"postSpacing"+this.leafAtom.uuid},text:this.leafAtom.beforeRest?" - ":"  "}))}}class u extends h{get glyphLabel(){return this.space.isSilent?" ":this.space.duration.isOne?",":0==this.space.duration.cmpNum(2)?";":"_"}get space(){return this.leafAtom}}class c extends h{get glyphLabel(){return this.note.value}needsRootElement(){return!0}createGlyphElement(){super.createGlyphElement(),1!=this.note.shift&&0==this.note.shift||(this.shiftElement=n.dv.createSVGNode("tspan",{doc:document,parent:this.rootText.element,attrs:{atomid:this.note.uuid,class:"noteShiftTSpan",id:"noteShift"+this.note.uuid,"baseline-shift":"sub"},text:(1==this.note.shift?"*":this.note.shift)+" "}))}moveGlyphToRoot(){this.shiftElement&&this.rootGroup.element.appendChild(this.shiftElement)}orderEmbelishments(){const t=this.note;t.octave>0?this.topSlot.push(new r.cq(this,t)):this.note.octave<0&&this.bottomSlot.push(new r.cq(this,t)),super.orderEmbelishments()}get note(){return this.leafAtom}}class d extends h{get glyphLabel(){return this.syllable.value}get syllable(){return this.leafAtom}}class m extends h{get glyphLabel(){return this.marker.text}get marker(){return this.leafAtom}}class p extends h{get glyphLabel(){return`[?${this.leafAtom.TYPE}]`}}function f(t,e,s=!1,n=1,o=0){let r;switch(e.TYPE){case i.aq.SPACE:r=new u(e);break;case i.aq.SYLLABLE:r=new d(e);break;case i.aq.NOTE:r=new c(e);break;case i.aq.LITERAL:if(s){const t=i.L7.fromLit(e);r=new c(t)}else{const t=i.nb.fromLit(e);r=new d(t)}break;case i.aq.GROUP:r=new l(e),r.defaultToNotes=s,r.scaleFactor=n;break;case i.aq.MARKER:r=new m(e);break;default:console.warn(`Unknown atom type: ${e.TYPE} - rendering placeholder`),r=new p(e)}return r.depth=o,r.createElements(t),r}},4836(t,e,s){function n(t){return class extends t{constructor(){super(...arguments),this.params=[]}getParam(t){var e,s;return null!==(s=null===(e=this.params.find(e=>e.key===t))||void 0===e?void 0:e.value)&&void 0!==s?s:null}getParamAt(t){var e,s;return null!==(s=null===(e=this.params[t])||void 0===e?void 0:e.value)&&void 0!==s?s:null}}}s.d(e,{Bb:()=>o,S_:()=>n,wC:()=>i});class i{constructor(t=null){if(this.TYPE="Entity",this.uuid=i.counter++,this._parent=null,this._eventsEnabled=!1,(t=t||{}).metadata)throw new Error("See where metadata is being passed")}enableEvents(){return this._eventsEnabled=!0,this}disableEvents(){return this._eventsEnabled=!1,this}get eventsEnabled(){return this._eventsEnabled}get parent(){return this._parent}setParent(t){this._parent=t}debugValue(){return{type:this.TYPE}}toString(){return`Entity(id = ${this.uuid})`}equals(t,e=!1){return this.TYPE==t.TYPE}clone(){const t=this.newInstance();return this.copyTo(t),t}copyTo(t){}newInstance(){return new this.constructor}}i.counter=0;class o extends i{constructor(){super(...arguments),this.TYPE="TimedEntity"}equals(t){return super.equals(t)&&this.duration.equals(t.duration)}}},5334(t,e,s){s.d(e,{Ab:()=>r,HO:()=>n,b_:()=>a,lD:()=>o});var n,i=s(9496);!function(t){t.Kampitham="Kampitham",t.Nokku="Nokku",t.Spuritham="Spuritham",t.Prathyagatham="Prathyagatham",t.Aahaatam_Raavi="Raavi",t.Aahaatam_Kandippu="Kandippu",t.Vaali="Vaali",t.Odukkal="Odukkal",t.Jaaru_Eetra="EetraJaaru",t.Jaaru_Irakka="IrakkaJaaru",t.Orikkai="Orikkai"}(n||(n={}));class o{constructor(t){this.type=t}debugValue(){return{type:this.type}}}class r extends o{constructor(t=!0,e=null){super(t?n.Jaaru_Eetra:n.Jaaru_Irakka),this.ascending=t,this.startingNote=e}debugValue(){const t=Object.assign(Object.assign({},super.debugValue()),{ascending:this.ascending});return this.startingNote&&(t.startingNote=this.startingNote.debugValue()),t}}function a(t){return""==(t=t.substring(1))?[new o(n.Kampitham),!0]:"^"==t?[new o(n.Aahaatam_Raavi),!0]:"~"==t?[new o(n.Vaali),!0]:"w"==t||"W"==t?[new o(n.Nokku),!0]:"∴"==t||":-"==t?[new o(n.Spuritham),!0]:"∵"==t||"-:"==t?[new o(n.Prathyagatham),!0]:"✓"==t||"./"==t||".\\"==t?[new o(n.Aahaatam_Kandippu),!0]:t.endsWith("/")?(t=t.substring(0,t.length-1).trim(),[new r(!0,t.length>0?new i.L7(t):null),!0]):t.endsWith("\\")?(t=t.substring(0,t.length-1),[new r(!1,t.length>0?new i.L7(t):null),!0]):"x"==t?[new o(n.Odukkal),!0]:"γ"==t||"Y"==t?[new o(n.Orikkai),!0]:[null,!1]}},5363(t,e,s){s.d(e,{A:()=>a});var n=s(3492),i=s.n(n),o=s(8748),r=s.n(o)()(i());r.push([t.id,":root{--notation-stroke-color: black;--notation-fill-color: transparent;--notation-text-color: #1a1a1a;--notation-border-color: gray;--notation-stroke-width: 1;--notation-bar-line-width: 1;--notation-line-padding: 5px;--notation-annotation-padding: 10px}:root.dark,[data-theme=dark]{--notation-stroke-color: #e5e5e5;--notation-fill-color: transparent;--notation-text-color: #f0f0f0;--notation-border-color: #555}@media(prefers-color-scheme: dark){:root:not(.light):not([data-theme=light]){--notation-stroke-color: #e5e5e5;--notation-fill-color: transparent;--notation-text-color: #f0f0f0;--notation-border-color: #555}}.notation-octave-dot{stroke:var(--notation-stroke-color);stroke-width:var(--notation-stroke-width)}.bar-start-line,.bar-end-line{stroke:var(--notation-stroke-color);stroke-width:var(--notation-bar-line-width)}.notation-jaaru-path{stroke:var(--notation-stroke-color);fill:var(--notation-fill-color)}.group-bracket-line{stroke:var(--notation-stroke-color);stroke-width:1}.group-bracket-circle{fill:var(--notation-stroke-color);stroke:none}.group-bracket{opacity:.8}.notationsContentRootTable text,.atomViewTextRoot,.notation-embelishment-label{fill:var(--notation-text-color)}.notationsContentRootTable,.rawBlockContentCell,.rawBlockContentCell *{color:var(--notation-text-color)}.role_sw text{fill:#2563eb}:root.dark .role_sw text,[data-theme=dark] .role_sw text{fill:#ef4444}@media(prefers-color-scheme: dark){:root:not(.light):not([data-theme=light]) .role_sw text{fill:#ef4444}}.lineRow{border:none}.lineAnnotationCell{padding:0px;padding-left:10px;padding-right:10px;padding-top:10px;vertical-align:top}.lineContentCell{padding:0px;padding-top:5px;padding-bottom:5px}.rawBlockRow{border:none}.rawBlockContentCell{padding-top:5px;padding-bottom:5px}.notationsContentRootTable{border-top:solid 1px var(--notation-border-color);width:100%}","",{version:3,sources:["webpack://./styles/NotationView.scss"],names:[],mappings:"AAIA,MAEE,8BAAA,CACA,kCAAA,CACA,8BAAA,CACA,6BAAA,CAGA,0BAAA,CACA,4BAAA,CAGA,4BAAA,CACA,mCAAA,CAIF,6BAEE,gCAAA,CACA,kCAAA,CACA,8BAAA,CACA,6BAAA,CAIF,mCACE,0CACE,gCAAA,CACA,kCAAA,CACA,8BAAA,CACA,6BAAA,CAAA,CASJ,qBACE,mCAAA,CACA,yCAAA,CAIF,8BAEE,mCAAA,CACA,2CAAA,CAIF,qBACE,mCAAA,CACA,+BAAA,CAIF,oBACE,mCAAA,CACA,cAAA,CAGF,sBACE,iCAAA,CACA,WAAA,CAGF,eACE,UAAA,CAIF,+EAGE,+BAAA,CAIF,uEAGE,gCAAA,CAQF,cACE,YAAA,CAIF,yDAEE,YAAA,CAIF,mCACE,wDACE,YAAA,CAAA,CAQJ,SACE,WAAA,CAGF,oBACE,WAAA,CACA,iBAAA,CACA,kBAAA,CACA,gBAAA,CACA,kBAAA,CAGF,iBACE,WAAA,CACA,eAAA,CACA,kBAAA,CAIF,aACE,WAAA,CAGF,qBACE,eAAA,CACA,kBAAA,CAMF,2BACE,iDAAA,CACA,UAAA",sourcesContent:['/* ========================================\n   CSS Custom Properties (Theme Variables)\n   ======================================== */\n\n:root {\n  /* Colors */\n  --notation-stroke-color: black;\n  --notation-fill-color: transparent;\n  --notation-text-color: #1a1a1a;\n  --notation-border-color: gray;\n\n  /* Strokes */\n  --notation-stroke-width: 1;\n  --notation-bar-line-width: 1;\n\n  /* Spacing (can be overridden) */\n  --notation-line-padding: 5px;\n  --notation-annotation-padding: 10px;\n}\n\n/* Dark mode */\n:root.dark,\n[data-theme="dark"] {\n  --notation-stroke-color: #e5e5e5;\n  --notation-fill-color: transparent;\n  --notation-text-color: #f0f0f0;\n  --notation-border-color: #555;\n}\n\n/* System preference fallback */\n@media (prefers-color-scheme: dark) {\n  :root:not(.light):not([data-theme="light"]) {\n    --notation-stroke-color: #e5e5e5;\n    --notation-fill-color: transparent;\n    --notation-text-color: #f0f0f0;\n    --notation-border-color: #555;\n  }\n}\n\n/* ========================================\n   SVG Element Styles\n   ======================================== */\n\n/* Octave indicator dots */\n.notation-octave-dot {\n  stroke: var(--notation-stroke-color);\n  stroke-width: var(--notation-stroke-width);\n}\n\n/* Bar lines (start and end) */\n.bar-start-line,\n.bar-end-line {\n  stroke: var(--notation-stroke-color);\n  stroke-width: var(--notation-bar-line-width);\n}\n\n/* Jaaru (glide) paths */\n.notation-jaaru-path {\n  stroke: var(--notation-stroke-color);\n  fill: var(--notation-fill-color);\n}\n\n/* Group bracket lines - top border of nested group containers */\n.group-bracket-line {\n  stroke: var(--notation-stroke-color);\n  stroke-width: 1;\n}\n\n.group-bracket-circle {\n  fill: var(--notation-stroke-color);\n  stroke: none;\n}\n\n.group-bracket {\n  opacity: 0.8;\n}\n\n/* Text elements - target all SVG text within notation */\n.notationsContentRootTable text,\n.atomViewTextRoot,\n.notation-embelishment-label {\n  fill: var(--notation-text-color);\n}\n\n/* HTML text elements (metadata, headings, markdown content) */\n.notationsContentRootTable,\n.rawBlockContentCell,\n.rawBlockContentCell * {\n  color: var(--notation-text-color);\n}\n\n/* ========================================\n   Role-specific Styles\n   ======================================== */\n\n/* Swara (Sw) role - blue in light theme for distinction from Sahitya */\n.role_sw text {\n  fill: #2563eb; /* Blue-600 */\n}\n\n/* Dark mode - red for swara */\n:root.dark .role_sw text,\n[data-theme="dark"] .role_sw text {\n  fill: #ef4444; /* Red-500 */\n}\n\n/* System preference fallback for dark mode */\n@media (prefers-color-scheme: dark) {\n  :root:not(.light):not([data-theme="light"]) .role_sw text {\n    fill: #ef4444; /* Red-500 */\n  }\n}\n\n/* ========================================\n   Layout Styles\n   ======================================== */\n\n.lineRow {\n  border: none;\n}\n\n.lineAnnotationCell {\n  padding: 0px;\n  padding-left: 10px;\n  padding-right: 10px;\n  padding-top: 10px;\n  vertical-align: top;\n}\n\n.lineContentCell {\n  padding: 0px;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  // border-bottom: solid 1px gray;\n}\n\n.rawBlockRow {\n  border: none;\n}\n\n.rawBlockContentCell {\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n\n.lineRootSVG {\n}\n\n.notationsContentRootTable {\n  border-top: solid 1px var(--notation-border-color);\n  width: 100%;\n}\n'],sourceRoot:""}]);const a=r},5691(t,e,s){s.r(e),s.d(e,{AlignedLine:()=>h.HX,Atom:()=>r.sz,AtomChangeType:()=>i.IX,AtomIterator:()=>a._d,AtomType:()=>r.aq,AtomView:()=>m.$X,Bar:()=>o.yP,Beat:()=>u.ds,BeatColDAG:()=>u.F5,BeatColumn:()=>u.V5,BeatDurationBlock:()=>c.St,BeatsBuilder:()=>u.v7,Block:()=>c.eB,BlockCommand:()=>d.V,BlockItemChangeType:()=>i.Tz,BreaksBlock:()=>c.eD,Carnatic:()=>b,ColAlign:()=>h.M8,Command:()=>c.uB,Cycle:()=>o.hc,CycleBlock:()=>c.sO,CycleCursor:()=>o.hp,DurationIterator:()=>a.D8,ElementShape:()=>m.ai,Embelishment:()=>m.Kf,Entity:()=>n.wC,FlatAtom:()=>a.R3,GlobalBeatLayout:()=>u.ye,GridCell:()=>h.LX,GridCellEvent:()=>h.$E,GridLayoutGroup:()=>h.ks,GridModel:()=>h.Qu,GridRow:()=>h.TW,Group:()=>r.YJ,GroupBlock:()=>c.xu,GroupView:()=>m.Jk,LayoutParams:()=>l.H,LeafAtom:()=>r.wR,LeafAtomView:()=>m.ZC,Line:()=>r.N1,Literal:()=>r.uS,Marker:()=>r.pH,MetaData:()=>c.es,ModelEvents:()=>i.ny,Notation:()=>c.FR,Note:()=>r.L7,ONE:()=>r.xr,ParamsMixin:()=>n.S_,Parser:()=>d.i,RawBlock:()=>c.oo,RepeatBlock:()=>c.Zx,Rest:()=>r.N9,Role:()=>r.Xh,RoleBlock:()=>c.oc,RoleChangeType:()=>i.P$,RoleDef:()=>c.SM,RowAlign:()=>h.yK,SectionBlock:()=>c.Hv,Shape:()=>m.yp,Space:()=>r.$x,Syllable:()=>r.nb,TimedEntity:()=>n.Bb,Utils:()=>f,WindowIterator:()=>a.Bh,ZERO:()=>r.f2,computeCollisionLayout:()=>m.ig,findContainingBlock:()=>c.vy,isBlock:()=>c.WH,isLine:()=>c.PA,isRawBlock:()=>c.sG,load:()=>p.H,parse:()=>p.q});var n=s(4836),i=s(1826),o=s(2049),r=s(9496),a=s(1292),l=s(7048),h=s(2022),u=s(9190),c=s(801),d=s(9589),m=s(8393),p=s(6464),f=s(9554),b=s(4929)},6278(t,e,s){s.d(e,{u:()=>a});var n=s(7757),i=s(4254),o=s(801),r=s(8877);class a{constructor(t,e){var s;this.rootElement=t,this.config=e,this.lineViews=[],this.currentSVGElement=null,this.layoutChangeUnsubscribe=null,this.beatViews=new Map,this.markerViews=new Map,this.loadChildViews(),this.markdownParser=null!==(s=null==e?void 0:e.markdownParser)&&void 0!==s?s:t=>t}get beatLayout(){return this._beatLayout}set beatLayout(t){this._beatLayout=t,t.gridLayoutGroup.getCellView=t=>this.viewForBeat(t)}loadChildViews(){this.tableElement=n.dv.createNode("table",{parent:this.rootElement,attrs:{class:"notationsContentRootTable"}})}renderNotation(t,e){this.notation=t,this.beatLayout=e;const s=performance.now();this.refreshLayout();const n=performance.now();console.log(`V4 Document, Layout Time: ${n-s}ms`)}addNewRow(t,e,s=!0){const i=n.dv.createNode("tr",{parent:this.tableElement,attrs:{class:e+"Row",id:e+"Row"+t}});let o=null;return s&&(o=n.dv.createNode("td",{parent:i,attrs:{class:e+"AnnotationCell",id:e+"Annotation"+t}})),[o,n.dv.createNode("td",{parent:i,attrs:{class:e+"ContentCell",id:e+"Content"+t,colspan:s?1:2}})]}newLineRoot(t,e){const[s,i]=this.addNewRow(e.uuid+"","line");return e.marginText&&(s.innerHTML=e.marginText),n.dv.createSVGNode("svg",{parent:i,attrs:{style:"margin-bottom: 10px",class:"lineRootSVG"}})}ensureLineView(t){let e=this.getLineView(t);if(null==e){const s=t.layoutParams||null,o=this.newLineRoot(this.tableElement,t);e=new i.k(o,t,{layoutParams:s}),t.isEmpty||(n.vA(null!=s,"Layout params for a non empty line *should* exist"),e.gridModel=this.beatLayout.getGridModelForLine(t.uuid)),this.lineViews.push(e)}return e}getLineView(t){return this.lineViews.find(e=>e.line==t)||null}get currentLineView(){return this.lineViews[this.lineViews.length-1]}clear(){this.lineViews=[],this.currentSVGElement=null,this.tableElement.innerHTML="",this.beatViews=new Map}refreshLayout(){const t=[];this.processBlock(this.notation,t);const e=performance.now();for(const s of t)s.gridModel.lastUpdatedAt=e;this.beatLayout.gridLayoutGroup.refreshLayout();for(const e of t)e.wrapToSize()}processBlock(t,e){for(const s of t.children())this.processBlockItem(s,e)}processBlockItem(t,e){if((0,o.sG)(t))this.renderBlock(t);else if((0,o.PA)(t)){const s=t;if(!s.isEmpty){const t=this.ensureLineView(s);e.push(t)}}else(0,o.WH)(t)&&this.processBlock(t,e)}renderBlock(t){const[,e]=this.addNewRow(t.uuid+"","rawBlock",!1);if("metadata"==t.contentType){const s=this.notation.metadata.get(t.content);if(s&&s.key.toLowerCase().indexOf(":")<0){const t=e.appendChild(n.dv.createNode("div")),i=`<span class = "${s.key.toLowerCase()}"><strong>${s.key}</strong>: ${s.value}</span>`;t.innerHTML=i}}else e.appendChild(n.dv.createNode("div")).innerHTML=this.markdownParser(t.content.trim());this.currentSVGElement=null}viewForBeat(t){if(t.colIndex%3==1){const e=t.value;let s=this.beatViews.get(e.uuid)||null;if(null==s){const n=e.role.line,i=this.ensureLineView(n),o=n.layoutParams;s=new r.u(t,e,i.gElem,o.cycle),this.beatViews.set(e.uuid,s),this.eagerlyPositionView(s,t)}return s}{const e=t.value,s=e.beat;let n=this.markerViews.get("pre:"+s.uuid)||null;if(null==n){const i=s.role.line,o=this.ensureLineView(i),a=(i.layoutParams,t.colIndex%3==0);n=new r.w(t,s,e.markers,a,o.gElem),this.markerViews.set("pre:"+s.uuid,n),this.eagerlyPositionView(n,t)}return n}}eagerlyPositionView(t,e){var s,n,i,o,r,a,l,h;const u=null!==(n=null===(s=e.colAlign)||void 0===s?void 0:s.coordOffset)&&void 0!==n?n:0,c=null!==(o=null===(i=e.rowAlign)||void 0===i?void 0:i.coordOffset)&&void 0!==o?o:0,d=null!==(a=null===(r=e.colAlign)||void 0===r?void 0:r.maxLength)&&void 0!==a?a:null,m=null!==(h=null===(l=e.rowAlign)||void 0===l?void 0:l.maxLength)&&void 0!==h?h:null;t.setBounds(u,c,d,m,!0)}}},6464(t,e,s){s.d(e,{H:()=>r,q:()=>o});var n=s(9190),i=s(9589);function o(t){return(new i.i).parseAndBuild(t)}function r(t,e={}){t=t||"";const s=new n.ye,i=performance.now(),[r,a]=o(t),l=performance.now();s.processBlock(r);const h=performance.now();return e.log&&console.log(`V4 Document, Parse Time: ${l-i}ms, Build Time: ${h-l}ms`),[r,s,a,{parseTime:l-i,buildTime:h-l}]}},7048(t,e,s){s.d(e,{H:()=>r});var n=s(7757),i=s(2049);const o=n.Vp.Fraction.ZERO;class r{constructor(t){this.uuid=r.counter++,t=t||{},this.beatDuration=t.beatDuration||1,"cycle"in t&&(this.cycle=t.cycle),this.cycle&&!this.cycle.duration.isZero||(this.cycle=i.hc.DEFAULT),this._rowStartOffsets=[],this._rowEndOffsets=[],this._rowDurations=[],this._totalLayoutDuration=o,this._totalBeats=0,this._beatLayouts=[],this.lineBreaks=t.lineBreaks||t.layout||[]}equals(t){return this.beatDuration==t.beatDuration&&this.cycle.equals(t.cycle)&&this.lineBreaksEqual(t._lineBreaks)}lineBreaksEqual(t){return this._lineBreaks.length==t.length&&this._lineBreaks.every((e,s)=>e==t[s])}debugValue(){var t;return{cycle:null===(t=this.cycle)||void 0===t?void 0:t.debugValue(),beatDuration:this.beatDuration,lineBreaks:this._lineBreaks}}getBeatLocation(t){const e=t.index%this.totalBeats;let s=0;for(let n=0;n<this._lineBreaks.length;n++){if(e<s+this._lineBreaks[n]){let r=o;if(e>s){const n=new i.hp(this.cycle,t.barIndex,t.beatIndex,t.instance);let[,o]=n.prev;for(let t=s;t<e;t++)[,o]=n.prev,r=r.plus(o.timesNum(this.beatDuration))}return[n,e-s,r]}s+=this._lineBreaks[n]}throw new Error("Invalid beat index: "+t.index)}get lineBreaks(){return this._lineBreaks&&0!=this._lineBreaks.length||(this.lineBreaks=[this.cycle.beatCount]),this._lineBreaks}set lineBreaks(t){this._lineBreaks=t,this.refreshLayout()}get beatLayouts(){return(!this._beatLayouts||this._beatLayouts.length<this.lineBreaks.length)&&this.refreshLayout(),this._beatLayouts}get totalBeats(){return this.beatLayouts,this._totalBeats}get totalLayoutDuration(){return this.beatLayouts,this._totalLayoutDuration}refreshLayout(){const t=this.cycle.iterateBeats(),e=this.beatDuration;this._beatLayouts=this.lineBreaks.map((s,n)=>{const i=[];for(let n=0;n<s;n++){const s=t.next().value;s[1]=s[1].timesNum(e),i.push(s)}return i}),this._totalBeats=this.lineBreaks.reduce((t,e)=>t+e,0),this._rowDurations=this._beatLayouts.map(t=>t.reduce((t,e)=>t.plus(e[1]),o)),this._rowDurations.forEach((t,e)=>{this._rowStartOffsets[e]=0==e?o:this._rowStartOffsets[e-1].plus(t)}),this._rowEndOffsets=this._rowDurations.map((t,e)=>this._rowStartOffsets[e].plus(t)),this._totalLayoutDuration=this._rowDurations.reduce((t,e)=>t.plus(e),o)}}r.counter=0},8393(t,e,s){s.d(e,{$X:()=>h,Jk:()=>c,Kf:()=>a,ZC:()=>u,ai:()=>l,ig:()=>o,yp:()=>r});var n=s(7757),i=s(9496);function o(t,e,s){const n=[];let o=0,r=i.f2;for(const i of t){let t=(e.isZero?0:r.timesNum(s).divby(e).floor)-i.glyphOffset;const a=t<o;a&&(t=o),n.push({x:t,wasCollision:a}),o=t+i.minWidth,r=r.plus(i.duration)}return n}class r{constructor(){this.shapeId=r.idCounter++,this._x=null,this._y=null,this._width=null,this._height=null,this.parentShape=null,this.children=[]}get bbox(){return this._bbox||(this._bbox=this.refreshBBox()),this._bbox}get minSize(){return this._minSize||(this._minSize=this.refreshMinSize()),this._minSize}invalidateBounds(){this._minSize=null,this._bbox=null}setBounds(t,e,s,n,i=!1){null!=t&&(isNaN(t)?this._x=null:this._x=t),null!=e&&(isNaN(e)?this._y=null:this._y=e),null!=s&&(isNaN(s)?this._width=null:this._width=s),null!=n&&(isNaN(n)?this._height=null:this._height=n);const[o,r,a,l]=this.updateBounds(t,e,s,n);return null!=o&&(isNaN(o)?this._x=null:this._x=o),null!=r&&(isNaN(r)?this._y=null:this._y=r),null!=a&&(isNaN(a)?this._width=null:this._width=a),null!=l&&(isNaN(l)?this._height=null:this._height=l),i&&this.refreshLayout(),[o,r,a,l]}get hasX(){return null!=this._x&&!isNaN(this._x)}get hasY(){return null!=this._y&&!isNaN(this._y)}get hasWidth(){return null!=this._width&&!isNaN(this._width)}get hasHeight(){return null!=this._height&&!isNaN(this._height)}get x(){return this._x||0}set x(t){this.setBounds(null==t?NaN:t,null,null,null)}get y(){return null!=this._y?this._y:0}set y(t){this.setBounds(null,null==t?NaN:t,null,null)}get width(){return null!=this._width?this._width:0}set width(t){this.setBounds(null,null,null==t?NaN:t,null)}get height(){return null!=this._height?this._height:0}set height(t){this.setBounds(null,null,null,null==t?NaN:t)}refreshLayout(){}}r.idCounter=0;class a extends r{}class l extends r{constructor(t){super(),this.element=t}refreshBBox(){return n.dv.svgBBox(this.element)}refreshMinSize(){return n.dv.svgBBox(this.element)}updateBounds(t,e,s,n){return[t,e,s,n]}refreshLayout(){this.hasX&&this.element.setAttribute("x",""+this._x),this.hasY&&this.element.setAttribute("y",""+this._y)}}class h extends r{constructor(){super(...arguments),this.depth=0,this.roleIndex=0}get glyphOffset(){return 0}}class u extends h{constructor(t){super(),this.leafAtom=t}isLeaf(){return!0}get viewId(){return this.leafAtom.uuid}get totalDuration(){return this.leafAtom.duration}}class c extends h{constructor(t,e){super(),this.group=t,this.atomViews=[],this.defaultToNotes=!0,this.needsLayout=!0,this.scaleFactor=1,this.showContinuationMarkers=!1,this.continuationMarkerElements=[],this.contentWidth=0,this.atomSpacing=2,this.setStyles(e||{})}get totalDuration(){return this.group.duration}createElements(t){this.groupElement=n.dv.createSVGNode("g",{parent:t,attrs:{class:"groupViewRoot",id:"groupViewRoot"+this.group.uuid}});for(const t of this.group.atoms.values()){if(t.TYPE===i.aq.MARKER)continue;const e=this.createAtomView(t);this.atomViews.push(e)}this.invalidateBounds()}isLeaf(){return!1}refreshBBox(){return n.dv.svgBBox(this.groupElement)}refreshMinSize(){let t=0,e=0;this.atomViews.forEach(s=>{const n=s.minSize,i=s.totalDuration;if(!i.isZero){const t=i.num/i.den,s=(n.width+this.atomSpacing)/t;e=Math.max(e,s)}t=Math.max(t,n.height)});const s=this.group.totalChildDuration,i=s.num/s.den,o=Math.max(0,e*i-this.atomSpacing);return new n.Dh.or(o*this.scaleFactor,t*this.scaleFactor)}updateBounds(t,e,s,n){return[t,e,s,n]}refreshLayout(){let t="translate("+this.x+","+this.y+")";this.scaleFactor<1&&(t+=" scale("+this.scaleFactor+")"),this.groupElement.setAttribute("transform",t);const e=this.minSize.height/this.scaleFactor,s=(this.hasHeight?this.height/this.scaleFactor:e)-e,n=this.group.totalChildDuration,o=this.minSize.width/this.scaleFactor,r=this.hasWidth?this.width/this.scaleFactor:o;this.clearContinuationMarkers();let a=i.f2,l=0;this.atomViews.forEach((t,e)=>{let i=(n.isZero?0:a.timesNum(r).divby(n).floor)-t.glyphOffset;i<l&&(i=l),t.setBounds(i,s,null,null,!0);const o=t.contentWidth||t.bbox.width;if(l=i+o,this.showContinuationMarkers&&!n.isZero){const e=t.totalDuration,i=e.num/e.den;if(i>1){const t=Math.floor(i)-1;for(let o=1;o<=t;o++){const t=a.plus(e.timesNum(o).divbyNum(Math.floor(i))).timesNum(r).divby(n).floor;this.renderContinuationMarker(t,s)}}}a=a.plus(t.totalDuration)}),this.contentWidth=l,this.invalidateBounds();for(const t of this.embelishments)t.refreshLayout();this.invalidateBounds()}clearContinuationMarkers(){for(const t of this.continuationMarkerElements)t.remove();this.continuationMarkerElements=[]}renderContinuationMarker(t,e){const s=n.dv.createSVGNode("text",{parent:this.groupElement,attrs:{class:"continuationMarker",x:t.toString(),y:e.toString()},text:","});this.continuationMarkerElements.push(s)}get embelishments(){return this._embelishments||(this._embelishments=this.createEmbelishments()),this._embelishments}createEmbelishments(){return[]}setStyles(t){"atomSpacing"in t&&(this.atomSpacing=t.atomSpacing),"showContinuationMarkers"in t&&(this.showContinuationMarkers=t.showContinuationMarkers),this.needsLayout=!0}}},8600(t,e,s){var n=s(4812),i=s.n(n),o=s(7381),r=s.n(o),a=s(1511),l=s.n(a),h=s(2932),u=s.n(h),c=s(7296),d=s.n(c),m=s(2077),p=s.n(m),f=s(5363),b={};b.styleTagTransform=p(),b.setAttributes=u(),b.insert=l().bind(null,"head"),b.domAPI=r(),b.insertStyleElement=d(),i()(f.A,b),f.A&&f.A.locals&&f.A.locals},8877(t,e,s){s.d(e,{u:()=>h,w:()=>l});var n=s(7757),i=s(8393),o=s(4760);class r extends i.ai{constructor(t,e,s,i,o){super(n.dv.createSVGNode("g",{parent:s,attrs:{class:`beatView role_${e.role.name}`,beatId:""+e.uuid,id:""+e.uuid,roleName:e.role.name,beatIndex:""+e.index,gridRow:t.rowIndex,gridCol:t.colIndex}})),this.cell=t,this.beat=e,this.rootElement=s,this.cycle=i,this.needsLayout=!0,this.atomView=this.createAtomView(),this.atomView&&this.atomView.refreshLayout()}get embelishments(){return this._embelishments||(this._embelishments=this.createEmbelishments()),this._embelishments}setStyles(t){this.needsLayout=!0}}var a=s(1029);class l extends i.ai{constructor(t,e,s,i,o,r){const a=n.dv.createSVGNode("g",{parent:o,attrs:{class:"markerView",pre:i,roleName:e.role.name,beatIndex:""+e.index,gridRow:t.rowIndex,gridCol:t.colIndex}});super(a),this.cell=t,this.beat=e,this.markers=s,this.isPreMarker=i,this.rootElement=o,this.needsLayout=!0,this.rootGroup=a,this.textElement=n.dv.createSVGNode("text",{parent:a,attrs:{class:"markerText",pre:i,dx:i?0:15},text:this.markers[0].text})}refreshMinSize(){const t=n.dv.svgBBox(this.textElement),e=t.width,s=t.height;return new n.Dh.or(e+5,s+5)}refreshLayout(){this.rootGroup.setAttribute("transform","translate("+this.x+","+this.y+")")}updateBounds(t,e,s,n){return[t,e,NaN,NaN]}}class h extends r{createAtomView(){const t=this.beat.contentAtom;return t?(0,o.jx)(this.element,t,this.beat.role.defaultToNotes):null}refreshLayout(){const t=this.hasX?this._x:0,e=this.hasY?this._y:0;this.element.setAttribute("transform","translate("+t+","+e+")"),this.hasWidth&&this.atomView&&(this.atomView.setBounds(0,0,this.width,null,!1),this.atomView.refreshLayout()),this.invalidateBounds();for(const t of this.embelishments)t.refreshLayout();this.invalidateBounds()}createEmbelishments(){let t=[];const e=this.beat,s=this.rootElement;if(0==e.beatIndex&&0==e.barIndex&&0==e.instance)t=[new a.Ey(this,s)];else{const n=this.cycle,i=n.bars[e.barIndex];e.beatIndex==i.beatCount-1&&e.instance==i.instanceCount(e.beatIndex)-1&&(t=e.barIndex==n.bars.length-1?[new a.Fg(this,s,2)]:[new a.Fg(this,s)])}return t}}},9190(t,e,s){s.d(e,{F5:()=>m,V5:()=>d,ds:()=>u,v7:()=>c,ye:()=>p});var n=s(7757),i=s(5691),o=s(1292),r=s(2022),a=s(801);const l=n.Vp.Fraction.ZERO,h=n.Vp.Fraction.ONE;class u{constructor(t,e,s,n,i,o,r,a,l){this.index=t,this.role=e,this.offset=s,this.duration=n,this.barIndex=i,this.beatIndex=o,this.instance=r,this.prevBeat=a,this.nextBeat=l,this.uuid=u.idCounter++,this.atomIsPlaceholder=!1}debugValue(){return{index:this.index,role:this.role.name,offset:this.offset.toString(),duration:this.duration.toString(),barIndex:this.barIndex,beatIndex:this.beatIndex,instance:this.instance,atom:this.atom.debugValue()}}get endOffset(){return this.offset.plus(this.duration)}get filled(){return this.remaining.isZero}get remaining(){return this.atom?this.duration.minus(this.atom.duration,!0):this.duration}add(t){return!(this.remaining.cmp(t.duration)<0||(this.atom?(this.atomIsPlaceholder||(this.atomIsPlaceholder=!0,this.atom=new i.Group(this.atom).setDuration(h,!0)),this.atom.addAtoms(!0,t)):this.atom=t,0))}get preMarkers(){return this.getMarkersWithPosition("before")}get postMarkers(){return this.getMarkersWithPosition("after")}getMarkersWithPosition(t){const e=[];if(!this.atom)return e;if(this.atom.TYPE===i.AtomType.GROUP){const s=this.atom;for(const n of s.atoms.values())if(n.TYPE===i.AtomType.MARKER){const s=n;s.position===t&&e.push(s)}}else if(this.atom.TYPE===i.AtomType.MARKER){const s=this.atom;s.position===t&&e.push(s)}return e}get contentAtom(){if(!this.atom)return null;if(this.atom.TYPE===i.AtomType.MARKER)return null;if(this.atom.TYPE!==i.AtomType.GROUP)return this.atom;const t=this.atom;let e=!1;for(const s of t.atoms.values())if(s.TYPE!==i.AtomType.MARKER){e=!0;break}return e?this.atom:null}}u.idCounter=0;class c{constructor(t,e,s=l,...n){this.role=t,this.layoutParams=e,this.startOffset=s,this.beats=[];const[,[i,r,a],h,u]=e.cycle.getPosition(s);this.cycleIter=e.cycle.iterateBeats(i,r,a),this.windowIter=new o.Bh,this.beatOffset=h,this.startIndex=u,this.addAtoms(...n)}addAtoms(...t){for(this.windowIter.push(...t);this.windowIter.hasMore;){let t=this.beats[this.beats.length-1];(0==this.beats.length||t.filled)&&(t=this.addBeat());const[e,s]=this.windowIter.get(t.remaining);n.vA(e.length>0,"Atleast one element should have been available here");for(const s of e)n.vA(t.add(s),"Should return true as we are already using a duration iterator here"),this.onAtomAdded&&this.onAtomAdded(s,t);t.filled&&this.onBeatFilled&&this.onBeatFilled(t)}}addBeat(){const t=this.beats.length,e=0==t?null:this.beats[t-1],s=this.cycleIter.next().value,n=this.layoutParams.beatDuration,o=new u(null==e?this.startIndex:e.index+1,this.role,null==e?this.startOffset.minus(this.beatOffset).timesNum(n,!0):e.endOffset,s[1].timesNum(n),s[0][0],s[0][1],s[0][2],e,null);return null==e&&this.beatOffset.isGT(l)&&o.add(new i.Space(this.beatOffset.timesNum(n))),e&&(e.nextBeat=o),this.beats.push(o),this.onBeatAdded&&this.onBeatAdded(o),o}}class d extends r.M8{constructor(t,e,s){super(),this.offset=t,this.endOffset=e,this.markerType=s,this.atomSpacing=2,t=t.factorized,e=e.factorized,this.key=d.keyFor(t,e,s)}static keyFor(t,e,s=0){return t=t.factorized,e=e.factorized,s<0?":"+t.toString():s>0?e.toString()+":":t.toString()+":"+e.toString()}}class m{constructor(t){this.layoutGroup=t,this.beatColumns=new Map}getBeatColumn(t,e,s=0){const[n,i]=this.ensureBeatColumn(t,e,s);if(i&&0==s){const[s]=this.ensureBeatColumn(t,e,-1),[i]=this.ensureBeatColumn(t,e,1);s.addSuccessor(n),n.addSuccessor(i);for(const n of this.beatColumns.values())-1==n.markerType&&e.equals(n.offset)?i.addSuccessor(n):1==n.markerType&&n.endOffset.equals(t)&&n.addSuccessor(s)}return n}ensureBeatColumn(t,e,s=0){const n=d.keyFor(t,e,s);let i=this.beatColumns.get(n)||null;const o=null==i;return i||(i=new d(t,e,s),this.beatColumns.set(n,i)),[i,o]}}class p{constructor(t){this.gridModelsForLine=new Map,this.roleBeatsForLine=new Map,this.beatColDAGsByLP=new Map,this.gridLayoutGroup=null!=t?t:new r.ks}getGridModelForLine(t){let e=this.gridModelsForLine.get(t)||null;return e||(e=new r.Qu,this.gridLayoutGroup.addGridModel(e),this.gridModelsForLine.set(t,e)),e}beatColDAGForLP(t){let e=this.beatColDAGsByLP.get(t)||null;return e||(e=new m(this.gridLayoutGroup),this.beatColDAGsByLP.set(t,e)),e}addLine(t){var e,s;const n=this.getGridModelForLine(t.uuid);null===(e=n.eventHub)||void 0===e||e.startBatchMode(),this.lineToRoleBeats(t,n),null===(s=n.eventHub)||void 0===s||s.commitBatch()}processBlock(t){for(const e of t.children())this.processBlockItem(e)}processBlockItem(t){if((0,a.PA)(t)){const e=t;e.isEmpty||null==e.layoutParams||this.addLine(e)}else(0,a.WH)(t)&&this.processBlock(t)}lineToRoleBeats(t,e){const s=t.layoutParams,n=[];this.roleBeatsForLine.set(t.uuid,n);const i=t.offset.divbyNum(s.beatDuration);for(const o of t.roles){const t=new c(o,s,i,...o.atoms);n.push(t.beats);for(const s of t.beats)this.addBeat(s,e)}return n}addBeat(t,e){const s=t.role.line,n=s.layoutParams,i=this.beatColDAGForLP(n.uuid),[o,a,l]=n.getBeatLocation(t),h=l.plus(t.duration,!0),u=i.getBeatColumn(l,h,0),c=t.role.line.indexOfRole(t.role.name),d=Math.floor(t.index/n.totalBeats),m=n.lineBreaks.length*d+o,p=s.roles.length*m+c,f=1+3*a,b=t.preMarkers;if(b.length>0){const s={beat:t,markers:b},n=i.getBeatColumn(l,h,-1);e.setValue(p,f-1,s,(t,e)=>{const s=new r.LX(t,e);return s.colAlign=n,s})}const g=t.postMarkers;if(g.length>0){const s={beat:t,markers:g},n=i.getBeatColumn(l,h,1);e.setValue(p,f+1,s,(t,e)=>{const s=new r.LX(t,e);return s.colAlign=n,s})}return e.setValue(p,f,t,(t,e)=>{const s=new r.LX(t,e);return s.colAlign=u,s})}}},9496(t,e,s){s.d(e,{$x:()=>p,L7:()=>g,N1:()=>w,N9:()=>m,Xh:()=>v,YJ:()=>A,aq:()=>l,f2:()=>r,nb:()=>b,pH:()=>d,sz:()=>h,uS:()=>f,wR:()=>u,xr:()=>a});var n=s(7757),i=s(4836),o=s(1826);const r=n.Vp.Fraction.ZERO,a=n.Vp.Fraction.ONE;var l;!function(t){t.NOTE="Note",t.LITERAL="Literal",t.SYLLABLE="Syllable",t.SPACE="Space",t.GROUP="Group",t.LABEL="Label",t.REST="Rest",t.MARKER="Marker"}(l||(l={}));class h extends i.Bb{constructor(t=a){super(),this.TYPE="Atom",this.nextSibling=null,this.prevSibling=null,this.parentGroup=null,this.isContinuation=!1,this._duration=t||a}get participatesInTiming(){return!0}debugValue(){const t=super.debugValue();return this.duration.isOne||(t.duration=this.duration.factorized.toString()),this.isContinuation&&(t.isContinuation=!0),t}copyTo(t){super.copyTo(t),t._duration=new n.Vp.Fraction(this.duration.num,this.duration.den)}get duration(){return this._duration}set duration(t){this._duration=t}}class u extends h{constructor(){super(...arguments),this.TYPE="LeafAtom",this.beforeRest=!1}splitAt(t){if(this.duration.cmp(t)>0){const e=this.createSpilloverSpace(this.duration.minus(t));return e.isContinuation=!0,this.duration=t,e}return null}createSpilloverSpace(t){return new p(t)}debugValue(){return this.beforeRest?Object.assign(Object.assign({},super.debugValue()),{beforeRest:!0}):super.debugValue()}}const c=(0,i.S_)(u);class d extends c{constructor(t,e=[]){super(r),this.name=t,this.TYPE="Marker",this.name=t.toLowerCase(),this.params=e}get participatesInTiming(){return!1}get text(){var t;const e=this.params.find(t=>null===t.key);return null!==(t=null==e?void 0:e.value)&&void 0!==t?t:""}get position(){return"after"===this.getParam("position")?"after":"before"}debugValue(){return{type:this.TYPE,name:this.name,params:this.params}}toString(){return`Marker(@${this.name}, ${JSON.stringify(this.params)})`}}class m extends u{constructor(){super(r),this.TYPE="Rest"}}class p extends u{constructor(t=a,e=!1){super(t),this.TYPE="Space",this.isSilent=!1,this.isSilent=e}debugValue(){return Object.assign(Object.assign({},super.debugValue()),{isSilent:this.isSilent})}toString(){return`Space(${this.duration}-${this.isSilent})`}copyTo(t){super.copyTo(t),t.isSilent=this.isSilent}equals(t){return super.equals(t)&&this.isSilent==t.isSilent}createSpilloverSpace(t){const e=super.createSpilloverSpace(t);return e.isSilent=this.isSilent,e}}class f extends u{constructor(t,e=a){super(e),this.value=t,this.TYPE="Literal",this.embelishments=[]}debugValue(){const t=Object.assign(Object.assign({},super.debugValue()),{value:this.value});return this.embelishments.length>0&&(t.embs=this.embelishments.map(t=>"debugValue"in t?t.debugValue():t)),t}toString(){return`Lit(${this.duration}-${this.value})`}equals(t){return super.equals(t)&&this.value==t.value}copyTo(t){super.copyTo(t),t.value=this.value}}class b extends f{constructor(){super(...arguments),this.TYPE="Syllable"}static fromLit(t){if(t.TYPE==l.SYLLABLE)return t;const e=new b(t.value,t.duration);return e.embelishments=t.embelishments,e.beforeRest=t.beforeRest,e}toString(){return`Syll(${this.duration}-${this.value})`}}class g extends f{constructor(t,e=a,s=0,n=0){super(t,e),this.TYPE="Note",this.octave=0,this.shift=0,this.octave=s,this.shift=n}static fromLit(t){if(t.TYPE==l.NOTE)return t;const e=new g(t.value,t.duration);return e.embelishments=t.embelishments,e.beforeRest=t.beforeRest,e}debugValue(){const t=Object.assign({},super.debugValue());return 0!=this.octave&&(t.octave=this.octave),0!=this.shift&&(t.shift=this.shift),t}toString(){return`Note(${this.duration}-${this.value}-${this.octave})`}equals(t){return super.equals(t)&&this.octave==t.octave&&this.shift==t.shift}copyTo(t){super.copyTo(t),t.octave=this.octave,t.shift=this.shift}}class A extends h{constructor(...t){super(0==t.length?r:a),this.TYPE="Group",this.durationIsSpeedMultiplier=!1,this.atoms=new n.Q8.M,this._observers=[],this.addAtoms(!1,...t)}addObserver(t){return this._observers.push(t),()=>this.removeObserver(t)}removeObserver(t){const e=this._observers.indexOf(t);e>=0&&this._observers.splice(e,1)}notifyObservers(t,e,s){var n,i,r;if(this._eventsEnabled)for(const a of this._observers)switch(t){case o.IX.ADD:null===(n=a.onAtomsAdded)||void 0===n||n.call(a,this,e,s);break;case o.IX.INSERT:null===(i=a.onAtomsInserted)||void 0===i||i.call(a,this,e,s);break;case o.IX.REMOVE:null===(r=a.onAtomsRemoved)||void 0===r||r.call(a,this,e)}}equals(t,e=!1){return!!super.equals(t)&&this.atoms.equals(t.atoms,(t,e)=>t.equals(e))}copyTo(t){super.copyTo(t),t.durationIsSpeedMultiplier=this.durationIsSpeedMultiplier;for(const e of this.atoms.values())t.atoms.add(e.clone())}get duration(){return this.durationIsSpeedMultiplier?this.totalChildDuration.divby(this._duration):this._duration}setDurationAsMultiplier(t=!0){return this.durationIsSpeedMultiplier=t,this}setDuration(t,e=!1){return this._duration=t,this.durationIsSpeedMultiplier=e,this}debugValue(){const t=Object.assign(Object.assign({},super.debugValue()),{atoms:Array.from(this.atoms.values(),t=>t.debugValue())});return this.durationIsSpeedMultiplier&&(t.durationIsSpeedMultiplier=!0),t}splitAt(t){if(this.duration.isLTE(t)||t.isLTE(r))return null;const e=new A;this.durationIsSpeedMultiplier&&(e.durationIsSpeedMultiplier=!0,e._duration=this._duration);let s=this.duration;const n=this.totalChildDuration,i=this.durationIsSpeedMultiplier?a.divby(this._duration):this._duration.divby(n,!0);for(;s.isGT(t)&&this.atoms.last;){const n=this.atoms.last,o=n.duration.times(i),r=s.minus(o);if(!r.isGTE(t)){const s=t.minus(r,!0).divby(i,!0),o=n.splitAt(s);if(null==o)throw new Error("Spill over cannot be null here");if(this.durationIsSpeedMultiplier){if(this._duration.isZero)throw new Error("How can this be?")}else this._duration=t;return o.isContinuation=!0,e.insertAtomsAt(e.atoms.first,!0,o),e}if(this.removeAtoms(!0,n),e.insertAtomsAt(e.atoms.first,!0,n),r.equals(t))return e;s=r}return e}get totalChildDuration(){let t=r;for(const e of this.atoms.values())t=t.plus(e.duration);return t}insertAtomsAt(t,e=!1,...s){const n=(e=e&&!this.durationIsSpeedMultiplier)?this.totalChildDuration:a;let i;if(t){i=0;for(const e of this.atoms.values()){if(e===t)break;i++}}else i=this.atoms.size;const r=[];for(const e of s){if(null!=e.parentGroup){if(e.parentGroup!=this)throw new Error("Atom belongs to another parent. Remove it first");e.parentGroup.removeAtoms(!1,e)}if(e.TYPE==l.REST){const t=this.atoms.last;t&&t.TYPE!=l.GROUP&&t.TYPE!=l.LABEL&&(t.beforeRest=!0)}else e.parentGroup=this,this.atoms.add(e,t),r.push(e)}if(e)if(this._duration.isZero){if(this.durationIsSpeedMultiplier)throw new Error("How can this be?");this._duration=this.totalChildDuration}else{const t=this.totalChildDuration.divby(n);this._duration=this._duration.times(t,!0)}if(r.length>0){const e=t?o.IX.INSERT:o.IX.ADD;this.notifyObservers(e,r,i)}return this}addAtoms(t=!1,...e){return this.insertAtomsAt(null,t,...e)}removeAtoms(t=!1,...e){const s=(t=t&&!this.durationIsSpeedMultiplier)?this.totalChildDuration:a,n=[];for(const t of e)if(t.parentGroup==this)this.atoms.remove(t),t.parentGroup=null,n.push(t);else if(null!=t.parentGroup)throw new Error("Atom cannot be removed as it does not belong to this group");if(t)if(this._duration.isZero){if(this.durationIsSpeedMultiplier)throw new Error("How can this be?");this._duration=this.totalChildDuration}else{const t=this.totalChildDuration.divby(s);this._duration=this._duration.times(t,!0)}return n.length>0&&this.notifyObservers(o.IX.REMOVE,n,-1),this}}class w extends i.wC{constructor(){super(...arguments),this.TYPE="Line",this.offset=r,this.roles=[],this.marginText="",this._observers=[]}addObserver(t){return this._observers.push(t),()=>this.removeObserver(t)}removeObserver(t){const e=this._observers.indexOf(t);e>=0&&this._observers.splice(e,1)}indexOfRole(t){for(let e=0;e<this.roles.length;e++)if(this.roles[e].name==t)return e;return-1}get isEmpty(){for(const t of this.roles)if(!t.isEmpty)return!1;return!0}debugValue(){const t=Object.assign(Object.assign({},super.debugValue()),{roles:this.roles.map(t=>t.debugValue())});return this.offset.isZero||(t.offset=this.offset.toString()),t}copyTo(t){super.copyTo(t),t.roles=this.roles.map(t=>t.clone())}addAtoms(t,e,...s){return this.ensureRole(t,e).addAtoms(...s),this}ensureRole(t,e){var s;let n=this.roles.findIndex(e=>e.name==t);if(n<0){n=this.roles.length;const i=new v(this,t);if(i.defaultToNotes=e,this.roles.push(i),this._eventsEnabled)for(const e of this._observers)null===(s=e.onRoleAdded)||void 0===s||s.call(e,this,t,i)}return this.roles[n]}removeRole(t){var e;const s=this.roles.findIndex(e=>e.name==t);if(s>=0){if(this.roles.splice(s,1),this._eventsEnabled)for(const s of this._observers)null===(e=s.onRoleRemoved)||void 0===e||e.call(s,this,t);return!0}return!1}get duration(){let t=r;for(const e of this.roles)t=n.Vp.Fraction.max(e.duration,t);return t}}class v extends i.wC{constructor(t,e){super(),this.line=t,this.name=e,this.TYPE="Role",this.defaultToNotes=!0,this.atoms=[],this._observers=[]}addObserver(t){return this._observers.push(t),()=>this.removeObserver(t)}removeObserver(t){const e=this._observers.indexOf(t);e>=0&&this._observers.splice(e,1)}notifyObservers(t,e,s){var n,i,r;if(this._eventsEnabled)for(const a of this._observers)switch(t){case o.IX.ADD:null===(n=a.onAtomsAdded)||void 0===n||n.call(a,this,e,s);break;case o.IX.INSERT:null===(i=a.onAtomsInserted)||void 0===i||i.call(a,this,e,s);break;case o.IX.REMOVE:null===(r=a.onAtomsRemoved)||void 0===r||r.call(a,this,e)}}get isEmpty(){return 0==this.atoms.length}debugValue(){return{name:this.name,atoms:this.atoms.map(t=>t.debugValue())}}addAtoms(...t){this.insertAtomsAt(this.atoms.length,...t)}insertAtomsAt(t,...e){const s=[];let n=t>0?this.atoms[t-1]:null;for(const i of e)i.TYPE==l.REST?n&&n.TYPE!=l.GROUP&&n.TYPE!=l.LABEL&&(n.beforeRest=!0):(this.atoms.splice(t+s.length,0,i),s.push(i)),n=i;if(s.length>0){const e=t>=this.atoms.length-s.length?o.IX.ADD:o.IX.INSERT;this.notifyObservers(e,s,t)}}removeAtoms(...t){const e=[];for(const s of t){const t=this.atoms.indexOf(s);t>=0&&(this.atoms.splice(t,1),e.push(s))}e.length>0&&this.notifyObservers(o.IX.REMOVE,e,-1)}copyTo(t){t.addAtoms(...this.atoms)}get duration(){return this.atoms.reduce((t,e)=>t.plus(e.duration),r)}}},9554(t,e,s){s.r(e),s.d(e,{SparseArray:()=>d,cycleStrToBarsStrs:()=>a,parseBar:()=>h,parseCycle:()=>l,parseProperty:()=>c,parseSyllable:()=>u});var n=s(7757),i=s(9496),o=s(2049);const r=n.Vp.Fraction.ONE;function a(t){return t.replace(/\|+/g,"|").split("|").map(t=>t.trim()).filter(t=>t.length>0)}function l(t){return new o.hc({bars:a(t).map(h)})}function h(t){const e=t.replace(/\s+/g," ").split(" "),s=new o.yP;if(1==e.length)for(let e=0;e<t.length;e++){let n=0;const i=t[e];if(","==i)n=1;else{const t=parseInt(i);t&&(n=t)}for(;n>0;)s.beatLengths.push(r),n--}else for(let t=0;t<e.length;t++){const i=e[t].split(":"),o=i[0],r=i[1]||"";0==o.length?s.beatLengths.push(n.Vp.Frac(1)):/^,+$/.test(o)?s.beatLengths.push(n.Vp.Frac(o.length)):s.beatLengths.push(n.Vp.Fraction.parse(o));const a=parseInt(r);isNaN(a)?s.beatCounts.push(1):s.beatCounts.push(a)}return s}function u(t){const e=[];for(let s=0;s<t.length;){let n=t[s];if("_"==n)e.push(new i.$x(r,!0)),s++;else if(","==n)e.push(new i.$x(r,!1)),s++;else{let o="";for(;s<t.length&&","!=n&&"_"!=n;)o+=n,s++,n=t[s];e.push(new i.nb(o))}}return 1==e.length?e[0]:new i.YJ(...e)}function c(t){const e=t.split("=").map(t=>t.trim());if(e.length<2)throw new Error("Properties must be of type <key> = <value>");return[e[0],e[1]]}class d{constructor(){this.runs=[]}get length(){let t=0;for(const[,e]of this.runs)t+=e.length;return t}valueAt(t,e){let s=null;return null==s&&e&&(s=e(),this.setAt(t,s)),s}setAt(t,...e){return this.splice(t,e.length,...e)}removeAt(t,e=1){return this.splice(t,e)}splice(t,e,...s){return this}}},9589(t,e,s){s.d(e,{V:()=>L,i:()=>T});var n=s(7757),i=s(4211),o=s(6529),r=s(2279),a=s(9496),l=s(801),h=s(9554);class u extends l.uB{get rawContents(){return this.getParamAt(0)}applyToBlock(t){const e=new l.oo(this.rawContents);t.addBlockItem(e),t.resetLine()}}class c extends l.uB{applyToBlock(t){t.setCurrRole(this.roleName)}get roleName(){return this.getParamAt(0)}}class d extends l.uB{constructor(...t){super(),this.atoms=t,this.index=0}debugValue(){return{name:this.name,index:this.index,atoms:this.atoms.map(t=>t.debugValue())}}applyToBlock(t){let e=t.currRoleDef;null==e&&(e=t.newRoleDef("Sw",!0));const s=t.currentLine,i=s.layoutParams;null==i?s.layoutParams=t.layoutParams:n.vA(i==t.layoutParams,"Layout parameters have changed so a new line should have been started"),s.addAtoms(e.name,e.notesOnly,...this.atoms)}}class m extends l.uB{applyToBlock(t){const e=t.newLine();e.offset=this.offset,e.marginText=this.marginText}get offset(){let t=this.getParam("offset")||n.Vp.Fraction.ZERO;return"number"==typeof t&&(t=new n.Vp.Fraction(t)),t}get marginText(){return this.params.length>0&&null==this.params[0].key&&"string"==typeof this.params[0].value?this.params[0].value.trim():this.getParam("marginText")||""}}class p extends l.uB{applyToBlock(t){const e=this.getParamAt(0);t.newRoleDef(e,this.notesOnly)}get notesOnly(){const t=this.getParam("notes");return"true"==t||"yes"==t||1==t}}class f extends l.uB{}class b extends l.uB{validateParams(){if(1!=this.params.length||"string"!=typeof this.params[0].value)throw new Error("layout command must contain one string argument")}applyToBlock(t){if(t instanceof l.FR){const e=this.params[0].value;t.ensureNamedLayoutParams(e)}}}class g extends f{get pattern(){return this.params.map(t=>t.value)}validateParams(){for(const t of this.params){if(null!=t.key)throw new Error("Breaks command cannot have keyword params");if("number"!=typeof t.value)throw new Error("Breaks command must be a list of integers")}}applyToBlock(t){t.localBreaks=this.pattern,t instanceof l.FR&&t.resetLayoutParams()}}class A extends f{applyToBlock(t){const e=this.params[0].value,s=(0,h.parseCycle)(e);t.localCycle=s,t instanceof l.FR&&t.resetLayoutParams()}}class w extends f{validateParams(){if(1!=this.params.length||"number"!=typeof this.params[0].value)throw new Error("beatDuration command must contain one number")}get beatDuration(){return this.params[0].value}applyToBlock(t){t.localAtomsPerBeat=this.beatDuration,t instanceof l.FR&&t.resetLayoutParams()}}class v extends l.uB{get sectionName(){return this.getParamAt(0)||""}validateParams(){if(this.params.length<1||"string"!=typeof this.params[0].value)throw new Error("section command must contain a string name")}applyToBlock(t){}}class E extends l.uB{get groupName(){return this.getParamAt(0)||""}applyToBlock(t){}}class y extends l.uB{get count(){const t=this.getParamAt(0);return"number"==typeof t?t:0}validateParams(){if(this.params.length>0){const t=this.params[0].value;if("number"!=typeof t||t<0)throw new Error("repeat command count must be a non-negative number")}}applyToBlock(t){}}var k=s(4929),C=s(5410);const S=n.Vp.Fraction.ONE,x=S.timesNum(2),[B]=i.Cf(String.raw`
    %define IdentChar     /[^%!@$#&\^|\[\]={}()<>+\-,;~: \t\f\r\n\v\\\.\'\"]/

    %token  BSLASH        "\\"
    %token  OPEN_SQ       "["
    %token  CLOSE_SQ      "]"
    %token  EQUALS        "="
    %token  OPEN_PAREN    "("
    %token  CLOSE_PAREN   ")"
    %token  OPEN_BRACE    "{"
    %token  CLOSE_BRACE   "}"
    %token  SLASH         "/"
    %token  STAR          "*"
    %token  CARET         "^"
    // %skip "-"
    %token  COMMA         ","
    %token  SEMI_COLON    ";"
    %token  COLON         ":"

    %token  FRONT_MATTER                 /^---$/m    { toFrontMatter }
    %token  SINGLE_LINE_RAW_STRING       />(.*)$/m    { toSingleLineRawString }
    %token  MULTI_LINE_RAW_STRING        /r(#{0,})"/  { toMultiLineRawString }

    %token  EMBELISHMENT  /~[^\s]*/                 { toEmbelishment }
    %token  NUMBER        /-?\d+/                   { toNumber }
    %token  BOOLEAN       /true|false/              { toBoolean }
    %token  STRING        /"([^"\\\n]|\\.|\\\n)*"/  { toString }
    %token  STRING        /'([^'\\\n]|\\.|\\\n)*'/  { toString }
    %token  MARKER_NAME   /\\@{IDENT}/              { toMarkerName }
    %token  DOTS_IDENT    /(\.+)({IdentChar}+)/     { toOctavedNote   }
    %token  IDENT_DOTS    /({IdentChar}+)(\.+)/     { toOctavedNote   }
    %token  IDENT_COLON   /{IdentChar}+:/           { toRoleSelector  }
    %token  IDENT         /{IdentChar}+/
    %token  BSLASH_IDENT  /\\{IDENT}/               { toCommandName   }
    %token  BSLASH_NUMBER /\\{NUMBER}/
    %token  HYPHEN        /-/
    %skip                 /[ \t\n\f\r]+/
    %skip_flex            "//.*$"
    %skip                 /\/\*.*?\*\//

    Document -> Elements
              | FRONT_MATTER Elements { prependFrontMatter }
              ;

    Elements -> Elements Command Atoms { appendCommand } 
              | Elements RoleSelector Atoms { appendRoleSelector } 
              | Elements Embedding  Atoms { insertEmbedding }
              | Atoms { appendAtoms }
              ;

    Embedding -> SINGLE_LINE_RAW_STRING | MULTI_LINE_RAW_STRING ;

    Command -> BSLASH_IDENT CommandParams ? OptBlock { newCommandWithBlock } ;
    CommandParams -> OPEN_PAREN ParamList ? CLOSE_PAREN { $2 } ;
    OptBlock -> Block
             | { nullBlock }
             ;
    Block -> BlockStart Elements CLOSE_BRACE { endBlock } ;
    BlockStart -> OPEN_BRACE { beginBlock } ;

    ParamList -> ParamList COMMA Param { concatParamList } ;
    ParamList -> Param { newParamList };
    Param -> ParamValue { newParam } ;
    Param -> ParamKey EQUALS ParamValue { newParam } ;
    ParamKey  -> IDENT ;
    ParamValue -> ( STRING | Fraction | NUMBER | BOOLEAN ) ;

    RoleSelector -> IDENT_COLON ;

    Atoms -> Atoms Atom { concatAtoms } ;
    Atoms -> { newArray } ;

    Atom -> Leaf ;

    Leaf -> Space | Lit | Group | Rest | Marker ;
    Marker -> MARKER_NAME CommandParams { newMarker } ;
    Leaf -> Duration Leaf { applyDuration } ;
    Rest -> HYPHEN { newRest };
    Space -> COMMA { newSpace } 
          | SEMI_COLON { newDoubleSpace } 
          | UNDER_SCORE { newSilentSpace } 
          ;

    /* - An alternative representation to support both pre and
     *   post embelishment operators.   Here PRE_EMBs have a higher
     *   associativity over POST_EMBs
     */
     Lit -> Lit POST_EMB  { litWithPostEmb }
         | PreEmbLit
         ;

     PreEmbLit -> LitToken 
                | LitToken CARET NUMBER { litWithCaret }
                | LitToken CARET STAR   { litWithCaret }
                | PRE_EMB PreEmbLit     { litWithPreEmb }
                ;
      
     LitToken -> DOTS_IDENT { litToAtom }
              | IDENT { litToAtom }
              | IDENT_DOTS { litToAtom }
              | STRING  { litToAtom }
              ;

    Group -> OPEN_SQ Atoms CLOSE_SQ { newGroup };

    Duration -> Fraction | NUMBER;
    Fraction -> NUMBER SLASH NUMBER { newFraction } ;
    `,{debug:"",type:"lalr",leftRecursive:!0,tokenHandlers:{toEmbelishment:(t,e,s)=>{const[n,i]=s.parseEmbelishment(t.value);return null==n?(console.log("Skipping Embelishment: ",t.value),s.errors.push(new o.S0(`Invalid embelishment: ${t.value}`,t.start,1+t.end-t.start,"InvalidEmbelishment",t.value)),null):(t.value=n,t.tag=i?"PRE_EMB":"POST_EMB",t)},toCommandName:(t,e,s)=>(t.value=t.value.substring(1),t),toBoolean:(t,e,s)=>(t.value="true"==t.value,t),toNumber:(t,e,s)=>(t.value=parseInt(t.value),t),toString:(t,e,s)=>(t.value=t.value.substring(1,t.value.length-1),t),toMarkerName:(t,e,s)=>(t.value=t.value.substring(2),t),toOctavedNote:(t,e,s)=>{if("DOTS_IDENT"==t.tag){const e=t.positions[1][1]-t.positions[1][0],s=t.value.substring(e);t.value=new a.L7(s,S,-e)}else{if("IDENT_DOTS"!=t.tag)throw new Error("Invalid token for converting to note: "+t.tag);{const e=t.positions[2][1]-t.positions[2][0],s=t.value.substring(0,t.value.length-e);t.value=new a.L7(s,S,e)}}return t},toRoleSelector:(t,e,s)=>(t.value=t.value.substring(0,t.value.length-1),t),toLineAnnotation:(t,e,s)=>(t.value=t.value.substring(1),t),toSingleLineRawString:(t,e,s)=>(t.value=t.value.substring(1),t),toMultiLineRawString:(t,e,s)=>{const n='"'+e.substring(t.positions[1][0],t.positions[1][1]),i=e.index,r=o.vR.advanceAfter(e,n)-n.length;if(r<0)throw new Error("EOF expected while finding end of Raw String Literal: '"+n+"'");return t.value=e.substring(i,r),t},toFrontMatter:(t,e,s)=>{const n=e.index,i=o.vR.advanceAfter(e,"\n---")-4;if(i<0)throw new Error("EOF expected while finding end of front matter");return t.value=e.substring(n,i),t}}});class L extends l.uB{constructor(t,e){super(t.params),this.innerCommand=t,this.blockCommands=e}get name(){return`Block(${this.innerCommand.name})`}createBlock(t){const e=this.innerCommand;if(e instanceof v)return new C.Hv(e.sectionName,t);if(e instanceof y)return new C.Zx(e.count,t);if(e instanceof A){const s=(0,h.parseCycle)(e.getParamAt(0));return new C.sO(s,t)}if(e instanceof w)return new C.St(e.beatDuration,t);if(e instanceof g)return new C.eD(e.pattern,t);if(e instanceof p){const s=e.getParamAt(0);return new C.oc(s,e.notesOnly,t)}return e instanceof E?new C.xu(e.groupName||null,t):new C.eB(e.name.toLowerCase(),t)}debugValue(){return{name:this.name,index:this.index,innerCommand:this.innerCommand.debugValue(),blockCommands:this.blockCommands.map(t=>t.debugValue())}}applyToNotation(t){const e=this.createBlock(t);for(const t of this.blockCommands)t.applyToBlock(e);t.addBlockItem(e)}applyToBlock(t){const e=this.createBlock(t);for(const t of this.blockCommands)t.applyToBlock(e);t.addBlockItem(e)}}class T{constructor(t){this.errors=[],this.metadata={},this.commands=[],this.blockStartStack=[],this.ruleHandlers={newFraction:(t,e,...s)=>1==s.length?new n.Vp.Fraction(s[0].value):new n.Vp.Fraction(s[0].value,s[2].value),newGroup:(t,e,...s)=>new a.YJ(...s[1].value).setDuration(x,!0),litWithCaret:(t,e,...s)=>{const n=a.L7.fromLit(s[0].value),i=s[2],o="STAR"==i.sym.label||i.value;return n.shift=o,n},litWithPreEmb:(t,e,...s)=>{const n=s[0],i=s[1].value;return i.embelishments.splice(0,0,n.value),i},litWithPostEmb:(t,e,...s)=>{const n=s[0].value,i=s[1];return n.embelishments.push(i),n},litToAtom:(t,e,...s)=>{const n=s[0];if("DOTS_IDENT"==n.sym.label||"IDENT_DOTS"==n.sym.label)return n.value;if("IDENT"==n.sym.label)return new a.uS(n.value);if("STRING"==n.sym.label)return new a.nb(n.value);throw new Error("Invalid lit: "+n)},newSpace:(t,e,...s)=>new a.$x,newRest:(t,e,...s)=>new a.N9,newDoubleSpace:(t,e,...s)=>new a.$x(S.timesNum(2)),newSilentSpace:(t,e,...s)=>new a.$x(S,!0),newMarker:(t,e,...s)=>{const n=s[0].value,i=s[1].value||[];return new a.pH(n,i)},applyDuration:(t,e,...s)=>{let n=s[0].value;const i=s[1].value;return"number"==typeof n&&(n=S.timesNum(n)),i.TYPE==a.aq.GROUP?i.setDuration(n,!0):i.duration=n,i},newArray:(t,e,...s)=>s.map(t=>t.value),concatAtoms:(t,e,...s)=>{const n=s[0].value,i=s[1].value;return n.push(i),n},newParam:(t,e,...s)=>1==s.length?{key:null,value:s[0].value}:{key:s[0].value,value:s[2].value},newParamList:(t,e,...s)=>[s[0].value],concatParamList:(t,e,...s)=>{const n=s[0].value,i=s[2].value;return n.push(i),n},beginBlock:(t,e,...s)=>(this.blockStartStack.push(this.commands.length),null),endBlock:(t,e,...s)=>{const n=this.blockStartStack.pop();return this.commands.splice(n)},nullBlock:(t,e,...s)=>null,newCommandWithBlock:(t,e,...s)=>{const n=s[0].value,i=s[1].value,o=s[2].value,r=this.createCommand(n,i);return null!==o?new L(r,o):r},appendAtoms:(t,e,...s)=>{const n=s[0].value;return n.length>0&&this.addCommand(new d(...n)),null},prependFrontMatter:(t,e,...s)=>{const n=s[0].value,i=r.Ay.parse(n);return console.log("Parsed FM: ",i),this.metadata=i,s[1].value},appendCommand:(t,e,...s)=>{const n=s[1].value;this.addCommand(n);const i=s[2].value;return i.length>0&&this.addCommand(new d(...i)),null},appendRoleSelector:(t,e,...s)=>{const n=s[1].value.toLowerCase().trim();this.addCommand(new c([{key:null,value:n}]));const i=s[2].value;return i.length>0&&this.addCommand(new d(...i)),null},insertEmbedding:(t,e,...s)=>{const n=s[1].value;this.addCommand(new u([{key:null,value:n}]));const i=s[2].value;return i.length>0&&this.addCommand(new d(...i)),null}}}createCommand(t,e){const s=t.trim().toLowerCase();if(e=e||[],"line"==s)return new m(e);if("role"==s)return new p(e);if("layout"==s)return new b(e);if("beatduration"==s)return new w(e);if("breaks"==s)return new g(e);if("cycle"==s)return new A(e);if("section"==s)return new v(e);if("group"==s)return new E(e);if("repeat"==s)return new y(e);throw new Error("Invalid command: "+s)}addCommand(t){t.index=this.commands.length,this.commands.push(t)}parse(t){this.errors=[];try{return B.parse(t,{tokenizerContext:this,ruleHandlers:this.ruleHandlers,onTokenError:t=>(this.errors.push(t),!0)})}catch(t){if(!(t instanceof i.mB))throw t;this.errors.push(t)}return null}parseAndBuild(t){this.parse(t);const e=new l.FR,s=[];s.push(...this.errors);for(const t in this.metadata)e.addMetaData(new l.es(t,this.metadata[t]));for(const t of this.commands)t.applyToNotation(e);return[e,s]}parseEmbelishment(t){return k.parseEmbelishment(t)}}}}]);
//# sourceMappingURL=126.734787bdf64205cf222c.js.map