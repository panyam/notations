!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("notations",[],t):"object"==typeof exports?exports.notations=t():(e.notations=e.notations||{},e.notations.SideBySidePlayground=t())}(this,()=>(()=>{"use strict";var e,t={2497(e,t,o){o.r(t),o.d(t,{SideBySidePlayground:()=>m});var i=o(7359),n=o(6464),s=o(4929);const r={debounceDelay:300,syncScroll:!0};class l{constructor(e={}){this.notation=null,this.beatLayout=null,this.debounceTimer=null,this.isScrollSyncing=!1,this.config=Object.assign(Object.assign({},r),e),this.editorElement=document.createElement("textarea"),this.editorElement.className="side-by-side-editor",this.config.editorClass&&(this.editorElement.className+=" "+this.config.editorClass),this.editorElement.spellcheck=!1,this.editorElement.placeholder="Enter notation source...",this.config.initialSource&&(this.editorElement.value=this.config.initialSource),this.outputElement=document.createElement("div"),this.outputElement.className="side-by-side-output",this.config.outputClass&&(this.outputElement.className+=" "+this.config.outputClass),this.notationView=new s.NotationView(this.outputElement,{sharedGridLayoutGroup:this.config.sharedGridLayoutGroup,markdownParser:this.config.markdownParser}),this.setupEventListeners(),this.config.initialSource&&this.render()}get source(){return this.editorElement.value}set source(e){this.editorElement.value=e,this.render()}getNotation(){return this.notation}getBeatLayout(){return this.beatLayout}render(){var e,t,o,i;const s=this.editorElement.value;this.notationView.clear();const[r,l,a]=(0,n.H)(s,{log:!1});return a.length>0?(this.notation=null,this.beatLayout=null,null===(t=(e=this.config).onParseError)||void 0===t||t.call(e,a),!1):(this.notation=r,this.beatLayout=l,this.notationView.renderNotation(r,l),null===(i=(o=this.config).onNotationParsed)||void 0===i||i.call(o,r,l),!0)}setupEventListeners(){this.editorElement.addEventListener("input",()=>{var e,t;null===(t=(e=this.config).onSourceChange)||void 0===t||t.call(e,this.editorElement.value),this.config.debounceDelay&&this.config.debounceDelay>0&&(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.render()},this.config.debounceDelay))}),this.config.syncScroll&&(this.editorElement.addEventListener("scroll",()=>{this.syncScrollToOutput()}),this.outputElement.addEventListener("scroll",()=>{this.syncScrollToEditor()}))}syncScrollToOutput(){if(this.isScrollSyncing)return;this.isScrollSyncing=!0;const e=this.editorElement,t=this.outputElement,o=e.scrollHeight-e.clientHeight;if(o<=0)return void(this.isScrollSyncing=!1);const i=e.scrollTop/o,n=t.scrollHeight-t.clientHeight;t.scrollTop=i*n,this.isScrollSyncing=!1}syncScrollToEditor(){if(this.isScrollSyncing)return;this.isScrollSyncing=!0;const e=this.editorElement,t=this.outputElement,o=t.scrollHeight-t.clientHeight;if(o<=0)return void(this.isScrollSyncing=!1);const i=t.scrollTop/o,n=e.scrollHeight-e.clientHeight;e.scrollTop=i*n,this.isScrollSyncing=!1}scrollToTop(){this.editorElement.scrollTop=0,this.outputElement.scrollTop=0}scrollToBottom(){this.editorElement.scrollTop=this.editorElement.scrollHeight,this.outputElement.scrollTop=this.outputElement.scrollHeight}scrollToLine(e){const t=this.editorElement.value.split("\n"),o=this.editorElement.scrollHeight/t.length;this.editorElement.scrollTop=(e-1)*o,this.syncScrollToOutput()}focus(){this.editorElement.focus()}insertAtCursor(e){var t,o;const i=this.editorElement.selectionStart,n=this.editorElement.selectionEnd,s=this.editorElement.value;this.editorElement.value=s.substring(0,i)+e+s.substring(n),this.editorElement.selectionStart=i+e.length,this.editorElement.selectionEnd=i+e.length,null===(o=(t=this.config).onSourceChange)||void 0===o||o.call(t,this.editorElement.value)}getSelection(){return{start:this.editorElement.selectionStart,end:this.editorElement.selectionEnd,text:this.editorElement.value.substring(this.editorElement.selectionStart,this.editorElement.selectionEnd)}}setSelection(e,t){this.editorElement.selectionStart=e,this.editorElement.selectionEnd=t}destroy(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.editorElement.remove(),this.outputElement.remove()}}const a={showConsole:!0,persistLayout:!0,storageKey:"notations-playground-layout",layoutVersion:1,syncScroll:!0};class c{constructor(e,t={}){var o;this.dockview=null,this.sideBySideEditor=null,this.consoleOutput=null,this.consoleEntries=[],this.container=e,this.config=Object.assign(Object.assign({},a),t),this._consoleVisible=null===(o=this.config.showConsole)||void 0===o||o,this.init()}get editor(){return this.sideBySideEditor}get source(){var e;return(null===(e=this.sideBySideEditor)||void 0===e?void 0:e.source)||""}set source(e){this.sideBySideEditor&&(this.sideBySideEditor.source=e)}log(e,t="info"){const o={timestamp:new Date,level:t,message:e};this.consoleEntries.push(o),this.renderConsoleEntry(o)}clearConsole(){this.consoleEntries=[],this.consoleOutput&&(this.consoleOutput.innerHTML="")}render(){var e;return(null===(e=this.sideBySideEditor)||void 0===e?void 0:e.render())||!1}destroy(){var e,t;null===(e=this.sideBySideEditor)||void 0===e||e.destroy(),null===(t=this.dockview)||void 0===t||t.dispose(),this.container.innerHTML=""}resetLayout(){this.config.storageKey&&localStorage.removeItem(this.config.storageKey),this.dockview&&(this.dockview.clear(),this.createDefaultLayout())}isConsoleVisible(){return this._consoleVisible}showConsole(){var e;if(this._consoleVisible||!this.dockview)return;this.dockview.addPanel({id:"console",component:"console",title:"Console",position:{direction:"below",referencePanel:"editor"}});const t=this.dockview.getPanel("console"),o=this.container.clientHeight||600;(null===(e=null==t?void 0:t.group)||void 0===e?void 0:e.api)&&t.group.api.setSize({height:Math.floor(.1*o)}),this._consoleVisible=!0}hideConsole(){if(!this._consoleVisible||!this.dockview)return;const e=this.dockview.getPanel("console");e&&e.api.close(),this._consoleVisible=!1}toggleConsole(){return this._consoleVisible?this.hideConsole():this.showConsole(),this._consoleVisible}init(){this.container.style.height||this.container.offsetHeight||(this.container.style.height="100%"),this.container.style.width=this.container.style.width||"100%";const e=this.isDarkMode(),t=new i.ax(this.container,{createComponent:e=>this.createComponent(e),theme:e?i.Qy:i.ef});new MutationObserver(()=>{const e=this.isDarkMode();t.updateOptions({theme:e?i.Qy:i.ef})}).observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),this.dockview=t.api,this.config.persistLayout&&this.loadLayout()||this.createDefaultLayout(),this.config.persistLayout&&this.dockview.onDidLayoutChange(()=>{this.saveLayout()}),requestAnimationFrame(()=>{this.render()}),this.log("Playground initialized","info")}isDarkMode(){return this.config.isDarkMode?this.config.isDarkMode():document.documentElement.classList.contains("dark")}saveLayout(){if(this.dockview&&this.config.storageKey)try{const e=this.dockview.toJSON(),t={version:this.config.layoutVersion,layout:e};localStorage.setItem(this.config.storageKey,JSON.stringify(t))}catch(e){console.warn("Failed to save layout:",e)}}loadLayout(){if(!this.dockview||!this.config.storageKey)return!1;try{const e=localStorage.getItem(this.config.storageKey);if(e){const t=JSON.parse(e);return t.version!==this.config.layoutVersion?(localStorage.removeItem(this.config.storageKey),!1):(this.dockview.fromJSON(t.layout),!0)}}catch(e){console.warn("Failed to load layout:",e),this.config.storageKey&&localStorage.removeItem(this.config.storageKey)}return!1}createComponent(e){switch(e.name){case"editor":return this.createEditorPanel();case"output":return this.createOutputPanel();case"console":return this.createConsolePanel();default:return{element:document.createElement("div"),init:()=>{}}}}createDefaultLayout(){var e,t,o;if(!this.dockview)return;const i=this.container.clientHeight||600,n=this.container.clientWidth||800;this.dockview.addPanel({id:"editor",component:"editor",title:"Editor"}),this._consoleVisible&&this.dockview.addPanel({id:"console",component:"console",title:"Console",position:{direction:"below",referencePanel:"editor"}}),this.dockview.addPanel({id:"output",component:"output",title:"Notation Output",position:{direction:"right",referencePanel:"editor"}});const s=this.dockview.getPanel("editor"),r=this.dockview.getPanel("console"),l=this.dockview.getPanel("output");(null===(e=null==r?void 0:r.group)||void 0===e?void 0:e.api)&&r.group.api.setSize({height:Math.floor(.1*i)}),(null===(t=null==s?void 0:s.group)||void 0===t?void 0:t.api)&&s.group.api.setSize({width:Math.floor(.5*n)}),(null===(o=null==l?void 0:l.group)||void 0===o?void 0:o.api)&&l.group.api.setSize({width:Math.floor(.5*n)})}createEditorPanel(){const e=document.createElement("div");return e.className="dvp-panel dvp-editor-panel",e.style.cssText="display: flex; flex-direction: column; height: 100%; padding: 0.5rem;",{element:e,init:t=>{const o=Object.assign(Object.assign({initialSource:this.config.initialSource,debounceDelay:300,syncScroll:this.config.syncScroll,markdownParser:this.config.markdownParser},this.config.editorConfig),{onSourceChange:e=>{var t,o,i,n;this.log(`Source changed (${e.length} chars)`,"info"),null===(o=(t=this.config).onSourceChange)||void 0===o||o.call(t,e),null===(n=null===(i=this.config.editorConfig)||void 0===i?void 0:i.onSourceChange)||void 0===n||n.call(i,e)},onNotationParsed:(e,t)=>{var o,i,n,s;const r=t.gridModelsForLine.size;this.log(`Parsed: ${r} line${1!==r?"s":""}`,"info"),null===(i=(o=this.config).onNotationParsed)||void 0===i||i.call(o,e,t),null===(s=null===(n=this.config.editorConfig)||void 0===n?void 0:n.onNotationParsed)||void 0===s||s.call(n,e,t)},onParseError:e=>{var t,o,i,n;e.forEach(e=>{this.log(`Parse error: ${e.message||e}`,"error")}),null===(o=(t=this.config).onParseError)||void 0===o||o.call(t,e),null===(n=null===(i=this.config.editorConfig)||void 0===i?void 0:i.onParseError)||void 0===n||n.call(i,e)},editorClass:this.config.editorClass});this.sideBySideEditor=new l(o);const i=this.sideBySideEditor.editorElement;i.style.cssText='\n          width: 100%;\n          height: 100%;\n          resize: none;\n          font-family: "SF Mono", "Monaco", "Inconsolata", "Fira Code", monospace;\n          font-size: 14px;\n          padding: 0.5rem;\n          border: 1px solid var(--dv-separator-border, #ddd);\n          border-radius: 4px;\n          outline: none;\n        ',e.appendChild(i)}}}createOutputPanel(){const e=document.createElement("div");return e.className="dvp-panel dvp-output-panel",e.style.cssText="display: flex; flex-direction: column; height: 100%;",{element:e,init:t=>{if(this.sideBySideEditor){const t=this.sideBySideEditor.outputElement;t.style.cssText="\n            width: 100%;\n            height: 100%;\n            overflow: auto;\n            padding: 1rem;\n          ",e.appendChild(t)}}}}createConsolePanel(){const e=document.createElement("div");return e.className="dvp-panel dvp-console-panel",e.style.cssText="display: flex; flex-direction: column; height: 100%;",{element:e,init:t=>{const o=document.createElement("div");o.className="dvp-console-header",o.style.cssText="\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 0.25rem 0.5rem;\n          font-size: 0.75rem;\n        ";const i=document.createElement("button");i.className="dvp-console-clear-btn",i.textContent="Clear",i.style.cssText="\n          padding: 0.125rem 0.5rem;\n          font-size: 0.75rem;\n          border-radius: 3px;\n          cursor: pointer;\n        ",i.onclick=()=>this.clearConsole(),o.appendChild(i),e.appendChild(o),this.consoleOutput=document.createElement("div"),this.consoleOutput.className="dvp-console-output",this.consoleOutput.style.cssText='\n          flex: 1;\n          overflow: auto;\n          padding: 0.5rem;\n          font-family: "SF Mono", "Monaco", "Inconsolata", monospace;\n          font-size: 0.75rem;\n        ',e.appendChild(this.consoleOutput),this.consoleEntries.forEach(e=>this.renderConsoleEntry(e))}}}renderConsoleEntry(e){if(!this.consoleOutput)return;const t=document.createElement("div");t.style.cssText="\n      padding: 0.125rem 0;\n      border-bottom: 1px solid var(--dv-separator-border, rgba(0,0,0,0.1));\n    ","error"===e.level?t.style.color="#f44336":"warning"===e.level&&(t.style.color="#ff9800");const o=e.timestamp.toLocaleTimeString();t.textContent=`[${o}] ${e.message}`,this.consoleOutput.appendChild(t),this.consoleOutput.scrollTop=this.consoleOutput.scrollHeight}}o(5188);var d=o(5691);const u=o(4078);function h(){const e=new u({html:!0});return t=>{const o=e.parse(t.trim(),{});return e.renderer.render(o,{langPrefix:"v4_"})}}o(8600),window.N=d;const g=[{name:"basic-scale",label:"Basic Scale",selected:!0,source:'\\cycle("|4|2|2|")\n\\beatDuration(4)\n\n\\line("Arohanam")\nSw: S R G M , P D N S.\n\n\\line("Avarohanam")\nSw: S. N D P , M G R S '},{name:"pallavi",label:"Pallavi with Sahitya",source:'\\cycle("|4|2|2|")\n\\beatDuration(4)\n\n\\line("Pallavi")\nSw: S R G M , P M G R , S _ _ _ , _ _ _ _\nSh: nin nu ko ri , va ra da nun , nu _ _ _ , _ _ _ _\n\nSw: S R G M , P M G R , S R G M , P _ _ _\nSh: nin nu ko ri , va ra da nun , nu ko ri , va _ _ _ '},{name:"second-speed",label:"Second Speed",source:'\\cycle("|4|2|2|")\n\\beatDuration(4)\n\n\\line("First Speed")\nSw: S R G M , P D N S.\n\n\\line("Second Speed")\nSw: SR GM PD NS. , S.N DP MG RS '},{name:"gamakas",label:"Gamakas",source:'\\cycle("|4|2|2|")\n\\beatDuration(4)\n\n\\line("Embellishments")\nSw: S ~R G /M\\ , P ~D N S.\nSw: S. \\N/ D ~P , M /G\\ R S '}];class m{constructor(){this.sampleSelect=null,this.playground=this.init()}init(){const e=document.getElementById("dockview-container");if(!e)throw new Error("Dockview container not found");this.setupToolbar();const t={showConsole:!0,persistLayout:!0,storageKey:"notations-playground-layout",layoutVersion:4,syncScroll:!0,markdownParser:h(),editorConfig:{debounceDelay:0},onSourceChange:e=>{var t;null===(t=this.playground)||void 0===t||t.log(`Source changed (${e.length} chars)`,"info")},onNotationParsed:(e,t)=>{var o;null===(o=this.playground)||void 0===o||o.log(`Parsed: ${t.gridModelsForLine.size} lines`,"info")},onParseError:e=>{e.forEach(e=>{var t;null===(t=this.playground)||void 0===t||t.log(`Parse error: ${e.message||e}`,"error")})},editorClass:"playground-editor"},o=new c(e,t);if(o.editor){o.editor.editorElement.addEventListener("keydown",e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey||e.altKey)&&(e.preventDefault(),this.render())});const e=o.editor.editorElement;e.style.fontFamily='"SF Mono", "Monaco", "Inconsolata", "Fira Code", monospace',e.style.fontSize="14px"}const i=g.find(e=>e.selected)||g[0];return this.loadSample(o,i),o}setupToolbar(){this.sampleSelect=document.getElementById("sample-select"),this.sampleSelect&&(this.sampleSelect.innerHTML=g.map(e=>`<option value="${e.name}" ${e.selected?"selected":""}>${e.label}</option>`).join(""),this.sampleSelect.addEventListener("change",()=>{const e=g.find(e=>e.name===this.sampleSelect.value);e&&this.loadSample(this.playground,e)}));const e=document.getElementById("render-btn");null==e||e.addEventListener("click",()=>this.render());const t=document.getElementById("reset-layout-btn");null==t||t.addEventListener("click",()=>this.resetLayout())}loadSample(e,t){e.source=t.source,e.log(`Loaded sample: ${t.label}`,"info")}render(){return this.playground.render()}resetLayout(){this.playground.resetLayout()}get source(){return this.playground.source}set source(e){this.playground.source=e}log(e,t="info"){this.playground.log(e,t)}clearConsole(){this.playground.clearConsole()}showConsole(){this.playground.showConsole()}hideConsole(){this.playground.hideConsole()}toggleConsole(){return this.playground.toggleConsole()}isConsoleVisible(){return this.playground.isConsoleVisible()}getPlayground(){return this.playground}}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("playground-container")&&(window.sideBySidePlayground=new m)})},4929(e,t,o){o.r(t),o.d(t,{BeatEndLines:()=>r.Fg,BeatStartLines:()=>r.Ey,BeatView:()=>s.u,Gamaka:()=>i.lD,GamakaType:()=>i.HO,GroupBracket:()=>r.cT,GroupView:()=>n.Jk,Jaaru:()=>r.e1,JaaruGamaka:()=>i.Ab,Kampitham:()=>r.RW,Kandippu:()=>r.jd,LabelEmbelishment:()=>r.Cn,LeafAtomView:()=>n.ZC,LeafAtomViewEmbelishment:()=>r.aL,LineView:()=>l.k,MarkerView:()=>s.w,Nokku:()=>r.B$,NotationView:()=>a.u,OctaveIndicator:()=>r.cq,Odukkal:()=>r.mN,Orikkai:()=>r.bM,Prathyagatham:()=>r.Cf,Raavi:()=>r.Kz,Spuritham:()=>r.uf,Vaali:()=>r.Un,createAtomView:()=>n.jx,parseEmbelishment:()=>i.b_});var i=o(5334),n=o(4760),s=o(8877),r=o(1029),l=o(4254),a=o(6278)}},o={};function i(e){var n=o[e];if(void 0!==n)return n.exports;var s=o[e]={id:e,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.exports}i.m=t,e=[],i.O=(t,o,n,s)=>{if(!o){var r=1/0;for(d=0;d<e.length;d++){for(var[o,n,s]=e[d],l=!0,a=0;a<o.length;a++)(!1&s||r>=s)&&Object.keys(i.O).every(e=>i.O[e](o[a]))?o.splice(a--,1):(l=!1,s<r&&(r=s));if(l){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[o,n,s]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={531:0};i.O.j=t=>0===e[t];var t=(t,o)=>{var n,s,[r,l,a]=o,c=0;if(r.some(t=>0!==e[t])){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(a)var d=a(i)}for(t&&t(o);c<r.length;c++)s=r[c],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(d)},o=this.webpackChunknotations=this.webpackChunknotations||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),i.nc=void 0;var n=i.O(void 0,[995,446,366,126,747],()=>i(2497));return i.O(n)})());
//# sourceMappingURL=SideBySidePlayground.381feabb9be92f031357.js.map